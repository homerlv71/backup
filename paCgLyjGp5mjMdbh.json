{"createdAt":"2025-07-25T01:01:36.779Z","updatedAt":"2025-08-12T14:52:14.338Z","id":"paCgLyjGp5mjMdbh","name":"Filipe-coco verde","active":false,"isArchived":false,"nodes":[{"parameters":{"content":"# Texto, Áudio, Imagem","height":720,"width":880,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-6976,1584],"typeVersion":1,"id":"efc27326-78db-49d3-9bcb-8c91c2ff7963","name":"Sticky Note1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0cb14635-2673-408e-86db-ce9e0373674b","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"conversation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"},"id":"075743f9-67d1-49ca-8121-2aabe9dc10a6"}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"60065893-74f7-4b64-bc1a-d891202efa78","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e7748f98-f95b-4cc7-b96a-112cf895ff59","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"productMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"catalogo"}]},"options":{}},"id":"9a1f927d-3611-403a-b77e-e7d420d54d06","name":"Message Type1","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-6912,1920]},{"parameters":{"operation":"push","list":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}","messageData":"={{ $json.text }}","tail":true},"id":"8e9145f1-8c19-445e-87ee-7edfc75cfc8d","name":"Audio Memory","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6208,1920],"credentials":{"redis":{"id":"3znV1WcVH7DjTFmo","name":"Redis account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-6336,1920],"id":"1d4ddc35-75ae-4764-ba89-a5616aebbe39","name":"OpenAI","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}","messageData":"={{ $('Webhook EVO').item.json.body.data.message.conversation }}","tail":true},"id":"b5408256-ead4-4659-ae7e-da42bbfc2f3c","name":"Text Memory1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6608,1696],"credentials":{"redis":{"id":"3znV1WcVH7DjTFmo","name":"Redis account"}}},{"parameters":{"content":"","height":460,"width":740,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5392,1776],"typeVersion":1,"id":"ab884116-c82f-477c-b7de-1ef88b419445","name":"Sticky Note22"},{"parameters":{"content":"# Gera/Consulta sessionId","height":80,"width":596,"color":5},"id":"088a57ff-758a-4395-89b8-2cbfdbc7cc59","name":"Sticky Note23","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-5312,1808]},{"parameters":{"content":"","height":440,"width":560,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5984,1776],"typeVersion":1,"id":"c3559962-af9e-419a-9724-de26122492ae","name":"Sticky Note42"},{"parameters":{"content":"# Dados","height":80,"width":150,"color":5},"id":"25ee0e81-1897-4840-95f2-fa5b0c7b9e7d","name":"Sticky Note43","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-5888,1808]},{"parameters":{"operation":"get","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5504,1936],"id":"3839b58d-c113-4c2b-9ae6-b65d024609e2","name":"Supabase","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"action":"generate"},"type":"n8n-nodes-base.crypto","typeVersion":1,"position":[-5184,2048],"id":"7bc9c6dc-1497-4674-a9ee-5a1cf7dc8862","name":"Gerar sessionID"},{"parameters":{"tableId":"FILIPE","fieldsUi":{"fieldValues":[{"fieldId":"sessionid","fieldValue":"={{ $item(\"0\").$node[\"Gerar sessionID\"].json[\"data\"] }}"},{"fieldId":"telefone","fieldValue":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"},{"fieldId":"timestamp","fieldValue":"={{ $now }}"},{"fieldId":"id_negociação","fieldValue":"={{ $item(\"0\").$node[\"HTTP Request4\"].json[\"id\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-4816,2048],"id":"b1120548-cef3-4d2a-802e-75a236598ab8","name":"Supabase1","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"operation":"formatDate","date":"={{ $now }}","format":"custom","customFormat":"dd-MM-yyyy","options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-5744,1936],"id":"7b63f09c-b1ab-45d4-b830-ac39f03468bc","name":"Date & Time1"},{"parameters":{"operation":"get","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $json.telefone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5008,1888],"id":"7ad1156a-4083-4a69-b148-26003783a0d3","name":"Get Dados","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"assignments":{"assignments":[{"id":"8d88c137-383f-4307-b3cc-1f6a560ea67b","name":"telefone","value":"={{ $item(\"0\").$node[\"Data Handler1\"].json[\"data\"][\"remoteJid\"] }}","type":"string"},{"id":"7e2f520e-4952-425b-82ca-792cc46680d4","name":"mensagem","value":"={{ $item(\"0\").$node[\"Merge\"].json[\"text\"] }}","type":"string"}]},"options":{}},"id":"13329ff2-c260-45bf-b8b2-9bd2b26072a1","name":"Variáveis","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5872,1936]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4a6d9aac-8565-4c58-abe3-8741393a5535","leftValue":"={{ $json.telefone }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5344,1936],"id":"6f46c890-c2d8-4e67-8668-c5deb0158277","name":"If5"},{"parameters":{"jsCode":"// Obtém os valores dos nós anteriores\nconst sessionid1 = $input.item.json.data;  // Do nó \"Gerar sessionID\"\nconst sessionid2 = $input.item.json.sessionid;  // Do nó \"Supabase\"\n\n// Retorna apenas o que existir, chamando sempre de \"sessionId\"\nreturn [{ sessionId: sessionid1 || sessionid2 || null }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4848,1888],"id":"ec28354e-5500-4cce-b338-0e72b6a4365d","name":"Code1"},{"parameters":{"numberInputs":4},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-5984,1920],"id":"d81aa171-1c48-4f61-8356-e001bfefd65a","name":"Merge"},{"parameters":{"httpMethod":"POST","path":"filipe","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-9168,2000],"id":"9f91be00-9464-4d71-a050-d7fdf74e0a67","name":"Webhook EVO","webhookId":"f62944a5-a8ec-4589-8e04-43b6526ae7e1"},{"parameters":{"assignments":{"assignments":[{"id":"62f6e880-1cec-403c-83b4-91f80e517451","name":"data.remoteJid","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"c6eb2538-aff4-44ec-ae16-8b970b0427a6","name":"data.fromMe","value":"={{ $json.body.data.key.fromMe }}","type":"boolean"},{"id":"cf750274-b641-4532-b4bf-f2424c665acb","name":"data.idMessage","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"8847d563-b0fd-44d6-b7cc-b6005f9cfff1","name":"data.conversation","value":"={{ $json.body.data.message.conversation }}","type":"string"},{"id":"881bee20-c3ce-4eac-8c5c-aef2391bf751","name":"data.messageType","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"b39c3487-e1ff-4e0c-8bec-e791e2fc929d","name":"data.date_time","value":"={{ $json.body.date_time }}","type":"string"},{"id":"5432d11e-d514-4503-9748-84322c59de45","name":"evo.instance","value":"={{ $json.body.instance }}","type":"string"},{"id":"189ea797-9a58-497a-a344-4035fca737af","name":"evo.server_url","value":"={{ $json.body.server_url }}","type":"string"},{"id":"0e0adf45-3b63-4dd3-997a-93028594c2bc","name":"evo.apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"c0f65baf-d145-46e4-88fa-2bb410aa3e24","name":"data.mediaUrl","value":"={{ $json.body.data.message.mediaUrl }}","type":"string"},{"id":"af1f3a40-e588-4356-ad4c-7589470cb6e2","name":"data.audiomessageurl","value":"={{ $item(\"0\").$node[\"Filter1\"].json[\"body\"][\"data\"][\"message\"][\"audioMessage\"][\"url\"] }}","type":"string"},{"id":"2abc2001-23e5-4c91-bfd3-a33103495ef6","name":"data.base64","value":"={{ $item(\"0\").$node[\"Filter1\"].json[\"body\"][\"data\"][\"message\"][\"base64\"] }}","type":"string"},{"id":"78bffbad-cad0-41ee-a29e-20a4d51d1a98","name":"","value":"={{ $json.body.data.key.remoteJid }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8864,2000],"id":"f8eb9066-9c7a-4c1d-b71c-097be7605a05","name":"Data Handler1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"54f96ed3-6d64-4362-82ba-387c0af3d2e6","leftValue":"={{ $item(\"0\").$node[\"Get Dados\"].json[\"possui_thread\"] }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3568,1888],"id":"aad88a5c-80d1-4179-b2c8-7b90a1eb679f","name":"verifivca thread"},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/threads","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"},{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3344,2064],"id":"c6ecc8b4-e851-43ec-8a94-5be1321fc70a","name":"criar thread","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Data Handler1\"].json[\"data\"][\"remoteJid\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"thread_id","fieldValue":"={{ $item(\"0\").$node[\"criar thread\"].json[\"id\"] }}"},{"fieldId":"possui_thread","fieldValue":"true"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-3104,2080],"id":"f14944e5-bf4c-48d0-901a-57f38eba70a8","name":"thread db","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"Get Dados\"].json[\"thread_id\"] }}/messages","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"},{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"role","value":"user"},{"name":"content","value":"={{ $item(\"0\").$node[\"Merge\"].json[\"text\"] }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3024,1808],"id":"ad911dbd-6983-42e8-a06e-b948c57ec420","name":"HTTP Request1","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"amount":50},"id":"4ce1fbd4-eb35-434a-ac5c-6470545e9763","name":"Wait3","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-2704,1808],"webhookId":"5e01e9fb-8552-451c-ad9d-1302f6a0b9ed"},{"parameters":{"url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"Get Dados\"].json[\"thread_id\"] }}/messages?order=desc","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"c95d89a2-6b65-488a-b310-96655887b136","name":"Listando as MSg1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2544,1808],"credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2ff87ddb-6fd7-4d89-af96-6d7776650d42","leftValue":"={{ $item(\"0\").$node[\"Wait3\"].json[\"msg_id\"] }}","rightValue":"={{ $item(\"0\").$node[\"Listando as MSg1\"].json[\"data\"][\"0\"][\"id\"] }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"id":"f5ef814e-62d6-4f18-a23f-aa71b7ef0f6a","name":"Verifica os IDs da MSG1","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2368,1808]},{"parameters":{},"id":"1b7d465d-83b3-4b6e-802a-d3469d58f1db","name":"No Operation, do nothing1","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2128,1920]},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"Get Dados\"].json[\"thread_id\"] }}/runs","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"assistant_id","value":"asst_jkH0NVW7gzZ9u6vLaGSs3L0s"},{"name":"additional_instructions","value":"=## Sempre chame o usuário pelo nome dele. \"{{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"nome\"] }}\"\n\n## Data e hora\n{{    (() => {     const nowNoTimeZone = new Date();     const now = nowNoTimeZone;     const daysOfWeek = ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'];          const today = new Date();     const totimeZone = today.toLocaleString(\"pt-BR\", { timeZone: \"America/Sao_Paulo\" });     const tomorrow = new Date(now.setDate(now.getDate() + 1));     const dayAfterTomorrow = new Date(now.setDate(now.getDate() + 1));     const nextWeekSameDay = new Date(today);     nextWeekSameDay.setDate(today.getDate() + 7);      return `A hora atual é ${new Intl.DateTimeFormat('pt-BR', {    hour: '2-digit',    minute: '2-digit',    timeZone: 'America/Sao_Paulo'  }).format(today)} e a data é ${today.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', timeZone: 'America/Sao_Paulo' })}, hoje o dia da semana é ${daysOfWeek[today.getDay()]}. A próxima ${daysOfWeek[today.getDay()]} será dia ${nextWeekSameDay.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })}.  Amanhã é ${daysOfWeek[tomorrow.getDay()]} dia ${tomorrow.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })}. Depois de amanhã é ${daysOfWeek[dayAfterTomorrow.getDay()]} dia ${dayAfterTomorrow.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })}.`;   })() }}, use isso para saber qual é o dia da semana atual e o que significa os termos \"semana que vem\", \"amanhã\", \"ontem\", \"anteontem\", etc.. Por exemplo: a semana contém 7 dias: segunda, terça, quarta, quinta, sexta, sábado e domingo. Se estamos na quarta-feira dia 24 de julho de 2024, e o cliente pede uma data na próxima terça, percorra o calendário e encontre o dia respectivo, que neste exemplo será 30 de julho de 2024. Seja extremamente cuidado com isso para não ocorrer erros de datas, você pode perder a oportunidade desse emprego caso erre qualquer data."}]},"options":{}},"id":"752539ed-1ce1-4b55-b12c-65dfcd194d0b","name":"Criar uma Run1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2176,1696],"credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"queued","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"queued"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ee64e027-bdae-4516-adaf-a1e0ef77740a","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"completed","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"completed"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"795763c2-ea1c-41ed-8f92-e1ac71caad30","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"in_progress","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"in_progress"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"321c076a-675d-4c7a-a168-5fe381f4a2c7","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"requires_action","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"requires_action"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"67a5c512-3fde-4105-887c-1087560f6fd8","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"cancelling","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"cancelling"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4029cbdc-f239-4efa-8d77-7779ee187fb2","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"cancelled","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"cancelled"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"44e0053d-cb24-4649-a6ef-e3d99d738b2d","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"failed","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"failed"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"849eb4aa-cd0a-47a3-a3ae-de84b7b0c335","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"incomplete","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"incomplete"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b38b8ab3-e6bd-4bc7-9f54-8873f98b5f84","leftValue":"={{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"status\"] }}","rightValue":"expired","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"expired"}]},"options":{}},"id":"d0085353-b4ac-4466-85d8-ef93e2b0ee53","name":"Verificar o Status da Run1","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1728,1584]},{"parameters":{"amount":3},"id":"c1d20dc0-afb9-45b9-a32e-e19adbbdade9","name":"Wait4","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1296,1824],"webhookId":"c03295f3-82d6-4f1e-a105-7dd1b3523324"},{"parameters":{"url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"Get Dados\"].json[\"thread_id\"] }}/messages?order=desc","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"6e071123-6307-44fc-b9b1-547d7ea98227","name":"Pega a Resposta do Assistente (IA)1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-816,1600],"credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"fieldToSplitOut":"message.chunks","options":{}},"id":"9a4fbc94-207a-4e1c-a43b-fefe710ff0c8","name":"Split Out1","type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-64,1600]},{"parameters":{"assignments":{"assignments":[{"id":"77918b09-d308-497f-b978-ded86bc5c09f","name":"message","value":"={{ $json.choices[0].message.content }}","type":"object"}]},"options":{}},"id":"ccd4685c-971b-441b-91e7-ba7feb4cde52","name":"Transformando em um Array1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-384,1600]},{"parameters":{"options":{}},"id":"81f54302-f1ca-4999-bd27-bafd534c53a3","name":"Loop Over Items1","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[160,1600]},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendText/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"},{"name":"text","value":"={{ $item(\"0\").$node[\"Loop Over Items1\"].json[\"message\"] }}"},{"name":"delay","value":"={{ (() => {   \nconst texto = $item(\"0\").$node[\"Loop Over Items1\"].json[\"message\"] || ''; // Captura o texto da mensagem   \nconst comprimento = texto.length; // Conta os caracteres    \nconst tempoPorCaractere = 70; // Tempo médio por caractere (em milissegundos)   \nreturn Math.round(comprimento * tempoPorCaractere); // Garante número inteiro \n})() }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"f0902a8d-296e-4f16-967e-609cd4bc9beb","name":"Envia MSG Texto1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[880,2160]},{"parameters":{},"id":"fed8de12-213d-47d7-92a6-64039b68fabd","name":"Wait5","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1280,2256],"webhookId":"f4c89c74-39b8-4b67-ba32-6c0883012c36"},{"parameters":{"url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"Get Dados\"].json[\"thread_id\"] }}/runs?order=desc","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"36dc7588-572e-4054-997c-50db42c5a7e1","name":"Listar a RUN2","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1984,1696],"credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"assignments":{"assignments":[{"id":"2393865a-a48b-4b2d-b312-757ca9f722dd","name":"funçoes","value":"={{ $json.data[0].required_action.submit_tool_outputs.tool_calls }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1856,864],"id":"de7c7255-bff9-46fa-8d24-cf406b31272f","name":"set feuntion"},{"parameters":{"fieldToSplitOut":"funçoes","options":{"destinationFieldName":"propriedades"}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-1632,864],"id":"24b6b174-83e1-4b92-9418-f115ecb80f97","name":"Split das funtion"},{"parameters":{"operation":"delete","tableId":"dados_cliente","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"553192566353@s.whatsapp.net"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1136,608],"id":"9f03f25a-3de1-402c-82b3-16fe681ca11f","name":"Supabase2"},{"parameters":{"assignments":{"assignments":[{"id":"a8c890df-15a2-4f96-b50e-fd871309291f","name":"arguments","value":"={{ $json.propriedades.function.arguments }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1152,880],"id":"33daa31a-437c-4ffb-b37c-69c0db92a4a0","name":"transforma objeto"},{"parameters":{"options":{"reset":"={{ $node [\"Loop1\"].context [\"done\"] }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1376,864],"id":"204c98d4-fd80-48b3-9b26-25cc2aaa488b","name":"Loop1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"=NOME","operator":{"type":"string","operation":"equals"},"id":"55b0e518-bd8b-422a-bb95-e0ca16f0b628"}],"combinator":"and"},"renameOutput":true,"outputKey":"NOME"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"470b4f69-9407-4024-8abb-25b247e0e5cc","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"QUALIFICACAO","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"qualificação"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f77fec3a-a897-4113-944b-707f00c0b126","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"DESEJO","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"desejo"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"77c4d8a8-3104-433c-a07a-106d0f791672","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"ETAPA","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"ETAPA"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6c58d593-3d34-4f8f-879c-1f0fe0f49aee","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"CONSULTA_CRM","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"buscatags"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f7eba11f-204e-4605-a039-58cae78eeb2b","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"atualizar_tag","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"atualizatags"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1297c1d3-ba0e-442a-bddd-6e1f6334f0c8","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"emergencia","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"emergencia"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f6b32b8a-542c-48e2-b1f4-1b05cd095e54","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"NOTIFICAR_EQUIPE_RESERVA","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"transfeferencia"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0a40082d-94d0-48a6-9a76-1a457569bd1e","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"TRANSFERENCIA","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"TRANSFERENCIA"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"26f42494-ccbf-4f2a-91bb-e6b1cbed7d14","leftValue":"={{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"function\"][\"name\"] }}","rightValue":"ATUALIZAR_TAG","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"ATUALIZAR_TAG"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-944,704],"id":"efbca837-d0e8-4dc3-8927-794bd5a4c75a","name":"Switch das funçoes"},{"parameters":{"assignments":{"assignments":[{"id":"19c2f445-633d-4245-9df5-3a5a47397fcc","name":"=output","value":"continue informando que o nome foi registrado, e que podemos continuar.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,-384],"id":"e09f413d-00e5-47c3-9f03-0101df4f54a0","name":"output"},{"parameters":{"numberInputs":10},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[1184,256],"id":"1b74ee53-1ade-41a7-bd1d-f087b570799d","name":"Merge1","alwaysOutputData":false},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"concatenate","field":"output"}]},"options":{"outputFormat":"singleItem"}},"type":"n8n-nodes-base.summarize","typeVersion":1.1,"position":[1424,736],"id":"982d1582-50e0-4901-8414-1872485f1aa2","name":"Summarize"},{"parameters":{"mode":"raw","jsonOutput":"={\n  \"tool_call_id\": \"{{ $item(\"0\").$node[\"Loop1\"].json[\"propriedades\"][\"id\"] }}\",\n  \"output\": {{ JSON.stringify($json.concatenated_output) }}\n}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2224,1328],"id":"23062d67-d2c9-4acd-93e6-47aa7a572ff3","name":"format output"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-1856,656],"id":"a16f73d8-e0b4-46ce-be4e-4ddcc41913c5","name":"Aggregate"},{"parameters":{"assignments":{"assignments":[{"id":"d0f4df19-3972-47b3-bf7b-986dc9ebb1f7","name":"tool_outputs","value":"={{ $json.data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1664,656],"id":"89075ff4-2091-40e0-8224-255a22bb741f","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"19c2f445-633d-4245-9df5-3a5a47397fcc","name":"=output","value":"registre a etapa na base e continue com o atendimento ","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,160],"id":"31b6aa72-e438-405d-bd53-1c52b301a07c","name":"output1"},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"Verifica os IDs da MSG1\"].json[\"data\"][\"0\"][\"thread_id\"] }}/runs/{{ $item(\"0\").$node[\"Listar a RUN2\"].json[\"data\"][\"0\"][\"id\"] }}/submit_tool_outputs","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"tool_outputs\": \n{{ $item(\"0\").$node[\"Edit Fields\"].json[\"tool_outputs\"] }}\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1456,656],"id":"faacc37e-4e29-4c4c-bd66-d0081e1d9b3c","name":"resposta fuction","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"sessionid","condition":"eq","keyValue":"={{ $('verifivca thread').item.json.sessionId }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"qualificação","fieldValue":"={{ $json.arguments.qualificado }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-208,-272],"id":"02261f52-e488-4bea-b851-8ca969759155","name":"Supabase5","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"assignments":{"assignments":[{"id":"19c2f445-633d-4245-9df5-3a5a47397fcc","name":"=output","value":"registre a qualificação na base e continue com o atendimento ","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,-272],"id":"e472973f-5316-4934-b5fa-09b6581289a5","name":"output2"},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"sessionid","condition":"eq","keyValue":"={{ $('verifivca thread').item.json.sessionId }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"desejo","fieldValue":"={{ $json.arguments.desejo }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-208,-128],"id":"cd537fab-3921-46bd-b0ce-69ea338dc44e","name":"Supabase6","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"assignments":{"assignments":[{"id":"19c2f445-633d-4245-9df5-3a5a47397fcc","name":"=output","value":"registre o desejo na base e continue com atendimento procurando saber da dor do cliente, (aonde ele esta necessitando de ajuda)","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,-128],"id":"f746de76-5b1e-4813-b7f8-12ca79bba756","name":"output3"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"802d70e0-8951-4aec-abc9-4258de6cc8bc","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"message\"][\"conversation\"] }}","rightValue":"/apagar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8704,2000],"id":"2cc42cf6-aea7-49a4-a532-2062664a384f","name":"EXCLUI DADOS"},{"parameters":{"operation":"delete","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-8512,1920],"id":"aba1e7bd-ff15-47ae-89e1-ae5384639831","name":"Supabase7","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"content":"","height":440,"width":660,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-4624,1776],"typeVersion":1,"id":"9be5f42a-5a54-403c-a675-c5563dd8a034","name":"Sticky Note26"},{"parameters":{"content":"# Pausa para Atendimento Humano","height":80,"width":596,"color":5},"id":"f85318a5-fcd6-4e4b-9917-24ebbe17bf72","name":"Sticky Note46","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4608,1808]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.block }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Ia Ativa"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3ef0e01c-cc14-4663-bb4d-2905b350c3ab","leftValue":"={{ $json.block }}","rightValue":"true","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Ia Desativada"}]},"options":{}},"id":"a5d08fef-f556-4a1e-988a-36a6b735d9f0","name":"Switch Block1","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-4128,2016]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"event\"] }}","rightValue":"outcoming","operator":{"type":"string","operation":"equals"},"id":"b3b60e4a-7202-44a2-a85e-959449fb763c"}],"combinator":"and"},"renameOutput":true,"outputKey":"outcoming"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"d7b42536-638f-4128-b51b-6aa913e9d9bc","leftValue":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"event\"] }}","rightValue":"incoming","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"incoming"}]},"options":{}},"id":"a88f6c6a-3ccd-4208-bb51-6d4c7bcd59d8","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-4592,1968]},{"parameters":{"operation":"set","key":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"chat_id\"] }}_block","value":"true","keyType":"string","expire":true,"ttl":80000000},"id":"22313135-76bf-4d99-ac8b-c4f27a8fb812","name":"PARA IA1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-4352,1904],"credentials":{"redis":{"id":"3znV1WcVH7DjTFmo","name":"Redis account"}}},{"parameters":{"operation":"get","propertyName":"block","key":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"chat_id\"] }}_block","options":{}},"id":"5db32065-8cf1-422e-bb19-27e86ebf913b","name":"Verificar Atendimento1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-4352,2064],"credentials":{"redis":{"id":"3znV1WcVH7DjTFmo","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"8f16b1bf-1a3e-4029-8d7a-1bccb919ee43","name":"message.message_id","value":"={{ $('Webhook EVO').item.json.body.data.key.id || '' }}","type":"string"},{"id":"11800d83-ecca-4f9c-a878-a2419db0c8e9","name":"message.chat_id","value":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid || '' }}","type":"string"},{"id":"c33f9527-e661-49e5-8e5e-64f3b430928a","name":"message.content_type","value":"={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.audioMessage ? 'audio' : '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage ? 'image' : '' }}","type":"string"},{"id":"06eba1c9-cff0-4f68-b6da-6bb0092466b7","name":"message.content","value":"={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation || '' }}","type":"string"},{"id":"b97f1af3-5361-46fc-9303-d644921231d8","name":"message.timestamp","value":"={{ $('Webhook EVO').item.json.body.data.messageTimestamp.toDateTime('s').toISO() }}","type":"string"},{"id":"dc3dc59c-90a3-4a45-bea2-de092c91083b","name":"message.content_url","value":"={{ $('Webhook EVO').item.json.body.data.message.audioMessage?.url || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.url || '' }}","type":"string"},{"id":"8b01a818-a456-476e-bace-adefe2f04eb4","name":"message.event","value":"={{ $('Webhook EVO').item.json.body.data.key.fromMe ? 'outcoming' : 'incoming' }}","type":"string"},{"id":"b2f1f6b5-292f-4695-9e41-be200c6d7053","name":"instance.name","value":"={{ $('Webhook EVO').item.json.body.instance }}","type":"string"},{"id":"572fcce5-8a26-4e8f-a48a-ef0bee569dcd","name":"instance.apikey","value":"={{ $('Webhook EVO').item.json.evo.apikey }}","type":"string"},{"id":"e90043db-657b-461c-b040-2d6089abfbdb","name":"instance.server_url","value":"={{ $('Webhook EVO').item.json.evo.server_url }}","type":"string"},{"id":"e2715775-5a17-4ff8-829f-f6ae1f05b225","name":"numero","value":"={{ $json.data.remoteJid.match(/^55?(\\d+)\\s*@/)[1] }}","type":"string"},{"id":"f287a777-4261-4e24-b6fc-40ece9015290","name":"nome","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"pushName\"] }}","type":"string"},{"id":"5bc5f004-61f1-4264-8673-a2178295dc79","name":"numero tratado","value":"={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"].includes('@lid') ?$item(\"0\").$node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"senderPn\"] : $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}","type":"string"}]},"options":{}},"id":"d74afa11-0840-44e0-ae1a-8f2aa71cae19","name":"dados_para_atendimento_humano","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8512,2064]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"edcb5496-d743-4609-9cde-d45905a28868","leftValue":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}","rightValue":"@s.whatsapp.net","operator":{"type":"string","operation":"contains"}},{"id":"8db90108-f7d6-48ad-b77d-7abf0e9a20a0","leftValue":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}","rightValue":"@s.whatsapp.net","operator":{"type":"string","operation":"contains"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-9008,2000],"id":"5274b961-1703-46bd-880c-884260eebab7","name":"Filter1"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3952,1840],"id":"e2b00482-7319-4eba-bbd2-663974b32a69","name":"No Operation, do nothing"},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"mimeType":"image/jpeg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-6464,2096],"id":"c61b0dab-493e-44c4-8890-a238b52a69ea","name":"Convert to File"},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"vision"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6352,2096],"id":"32f8e95f-fcdc-4c95-84fd-bacf9da748a0","name":"upload imagem","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"94163859-7166-4876-a09a-d4f4238447c4","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3392,1744],"id":"d17347d0-dfc5-4961-abd3-67975f8c3186","name":"verifica se e imagemn"},{"parameters":{"assignments":{"assignments":[{"id":"53e5ccb9-2120-4bbd-8700-968824e7f6c3","name":"mensagem","value":"={{ 'Analise a imagem fornecida com o maximo de detalhes. '+'Observcações adicionais:' }} {{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"message\"][\"imageMessage\"][\"caption\"] }}","type":"string"},{"id":"82cdf0ad-ca12-4042-8b77-fa1c33f941dc","name":"","value":"","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3232,1600],"id":"3cfadbef-45c5-4bb9-878f-5288160bf1ca","name":"set imagem"},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"Get Dados\"].json[\"thread_id\"] }}/messages","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"role\": \"user\",\n  \"content\": [\n   {\n     \"type\": \"image_file\",\n     \"image_file\":  {\n      \"file_id\": \"{{ $item(\"0\").$node[\"upload imagem\"].json[\"id\"] }}\"\n     }\n    },\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.mensagem }}\"\n     }\n   ]\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3072,1600],"id":"2033b527-cc96-4437-92d9-d597813ff51c","name":"insere iamgem","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"assignments":{"assignments":[{"id":"2a51ef8d-22c1-4cbd-b336-f35b1591ee4e","name":"msg_id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2912,1600],"id":"8239525a-007c-487a-8e8a-21b32e5d767a","name":"id da imagem"},{"parameters":{"assignments":{"assignments":[{"id":"2a51ef8d-22c1-4cbd-b336-f35b1591ee4e","name":"msg_id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2864,1808],"id":"2f164469-3e18-481a-a2a0-5858ee7da689","name":"id da mensagem"},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/chat/completions","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n   \"model\": \"gpt-4o-mini-2024-07-18\",\n   \"messages\": [\n     {\n       \"role\": \"system\",\n       \"content\": \"Você é um sistema especializado em dividir mensagens em chunks seguindo regras específicas. Analise a mensagem de entrada e divida-a em chunks seguindo estas regras obrigatórias:\\n\\nREGRAS DE CHUNKING:\\n\\n1. REGRAS GERAIS:\\n   - Cada chunk deve conter no máximo 2-3 frases completas por parágrafo\\n   - Preserve a ordem original do conteúdo\\n   - Não modifique o conteúdo original de forma alguma\\n   - Use '\\\\n' para representar quebras de linha\\n   - Não ignore nenhuma parte do texto\\n   - Mensagens dentro de <template_de_respostas> devem ser agrupadas em um único chunk, devendo ocupar o espaço de uma única mensagem. A tag '<template_de_respostas>' não deve aparecer na resposta ao usuário. \\n\\n2. REGRAS PARA MÍDIA:\\n   \\n   EXEMPLO DE ENTRADA:\\n   ```\\n   \\\"E aeee! Olha só, quero te mostrar a nossa Área de Membros TOP que você terá acesso por R$ 19,90: <video>https://cdn.xpiria.com.br/xpiria/tour_area_de_membros.mp4 </video>\\n   \\n   E aí, será que vale a pena? Mas me conta, você é iniciante ou já trabalha com automações e IA?\\\"\\n   ```\\n\\n   CHUNKS CORRETOS:\\n   ```\\n   {\\\"message\\\": \\\"E aeee! Olha só, quero te mostrar a nossa Área de Membros TOP que você terá acesso por R$ 19,90\\\", \\\"sequence_number\\\": 1},\\n   {\\\"message\\\": \\\"<video>https://cdn.xpiria.com.br/xpiria/tour_area_de_membros.mp4 </video>\\\", \\\"sequence_number\\\": 2},\\n   {\\\"message\\\": \\\"E aí, será que vale a pena? Mas me conta, você é iniciante ou já trabalha com automações e IA?\\\", \\\"sequence_number\\\": 3}\\n   ```\\n\\n   REGRAS:\\n   - Cada mídia (imagem, vídeo, documento ou áudio) deve estar em um chunk separado\\n   - Formatos de mídia são identificados por:\\n     * Imagens: `<imagem>url</imagem>`\\n     * Vídeos: `<video>url</video>`\\n     * Áudios: `<audio>url</audio>`\\n  * Documentos: `<documento>url</documento>`\\n - Links normais (URLs ou markdown) devem permanecer junto com seu texto\\n   - Textos introdutórios de mídia devem ficar em chunks separados\\n\\n3. REGRAS DE FORMATAÇÃO:\\n   - Mantenha emojis e formatação especial exatamente como no original\\n   - Preserve espaços e quebras de linha conforme o original\\n   - Não adicione pontuação ou formatação extra\\n\\n4. REGRAS DE VALIDAÇÃO:\\n   - Cada mídia deve estar em seu próprio chunk\\n   - Confirme se cada chunk tem um número de sequência único\\n   - Garanta que o conteúdo total dos chunks equivale exatamente ao conteúdo original\\n - Garanta que as mensagens contidas em <template_de_respostas> estão em apenas um único chunk \\n\\n PROCESSO DE ANÁLISE:\\n1. Identifique elementos de mídia (imagens, vídeos, documentos ou áudios)\\n2. Separe textos introdutórios de mídia\\n3. Mantenha URLs e links normais junto com seu texto\\n4. Aplique as regras de chunking conforme os exemplos acima\\n5. Valide o resultado final\\n\\nFormate a saída como um objeto JSON.\"\n     },\n     {\n       \"role\": \"user\",\n       {{ `\"content\": ${JSON.stringify($json[\"data\"].filter(item => item.role === \"assistant\")[0].content[0].text.value)}` }}\n   }\n   ],\n   \"response_format\": {\n     \"type\": \"json_schema\",\n     \"json_schema\": {\n \"name\": \"message_chunks\",\n \"strict\": true,\n \"schema\": {\n   \"type\": \"object\",\n   \"properties\": {\n     \"chunks\": {\n       \"type\": \"array\",\n       \"description\": \"An array of message chunks, where each chunk is a separate paragraph.\",\n       \"items\": {\n         \"type\": \"object\",\n         \"properties\": {\n           \"message\": {\n             \"type\": \"string\",\n             \"description\": \"An exact extraction from the original message. Each chunk must strictly reflect a coherent segment of the input, matching the original format and content without alteration. Links and media must appear in exclusive chunks, isolated, never duplicated, and never omitted.\"\n           },\n           \"sequence_number\": {\n             \"type\": \"number\",\n             \"description\": \"The order of this chunk in the original message.\"\n           }\n         },\n         \"required\": [\n           \"message\",\n           \"sequence_number\"\n         ],\n         \"additionalProperties\": false\n       }\n     }\n   },\n   \"required\": [\n     \"chunks\"\n   ],\n   \"additionalProperties\": false\n }\n}\n   }\n }","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-592,1600],"id":"bf7f3eca-195c-4cf5-a4d4-b32145212880","name":"HTTP Request2","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"content":"## RESPOSTA ASSISTANTS","height":300,"width":700,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-896,1504],"id":"358bf662-d47c-41ef-b689-5ed3bc7b7308","name":"Sticky Note"},{"parameters":{"content":"FRACIONAMENTO\n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":260,"width":960,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-128,1520],"id":"f0ae2d4a-2d30-4fd6-bec0-d2961cc842f5","name":"Sticky Note2"},{"parameters":{"content":"## DESCOBRE ATENDIMENTO \n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":420,"width":980},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-8352,1920],"id":"128c0ad3-6af9-4c8b-bf2a-f357b09382ab","name":"Sticky Note3"},{"parameters":{"assignments":{"assignments":[{"id":"c8c7f85d-06fb-4a38-b508-312941aaf852","name":"dados","value":"=nome: {{ $json.name }}\nemail: {{ $json.skype }}\ntelefone: {{ $json.phones[0].phone }}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-128,400],"id":"2844aa32-3ba2-40c5-ba13-963c775bc14d","name":"qual tag","alwaysOutputData":true},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"chat_id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"created_at","fieldValue":"={{ $now }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5168,1888],"id":"91715d69-be90-465d-aefe-9dc7803ff35f","name":"Supabase9","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"mimeType":"audio/ogg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-6448,1920],"id":"08c4633f-34c1-41e2-8c7a-f8fe25a293bd","name":"Convert to File1"},{"parameters":{"assignments":{"assignments":[{"id":"c14d1498-16cb-4f82-9570-fb6ffa273991","name":"text","value":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"content\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6384,1696],"id":"39940748-12ba-4520-be24-2a76e1d70817","name":"Edit Fields6"},{"parameters":{"assignments":{"assignments":[{"id":"f2a6cac7-dc7b-41a7-a9c2-cabbaca00b45","name":"output","value":"crm atualizado apenas continue","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,560],"id":"fc1dc7c1-ee1a-4388-b277-f9dae77af7ba","name":"Edit Fields7"},{"parameters":{"assignments":{"assignments":[{"id":"0ae7b45f-bd05-4100-9f68-ccf9da1831bc","name":"output","value":"=AQUI ESTA TUDO RETORNADO DO CRM OS DADOS DO LEAD: {{ $json.dados }}\nREGISTRE ISSO PARA USAR NAS RESPOSTA E CONTINUE.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,400],"id":"29343e73-efcf-4d06-ad53-577334a3b699","name":"Edit Fields8"},{"parameters":{"numberInputs":10},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[1184,688],"id":"37104038-f673-4b91-81d0-445ecb895775","name":"Merge2","alwaysOutputData":false},{"parameters":{"method":"=POST","url":"={{ $('Webhook EVO').item.json.body.server_url }}/chat/getBase64FromMediaMessage/{{ $('Webhook EVO').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook EVO').item.json.body.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.ID }}\"\n    }\n  },\n  \"convertToMp4\": false\n} ","options":{"redirect":{"redirect":{}}}},"id":"f8eb7df3-8f7f-483f-a457-a02bccc4ce84","name":"Coloque o ID da mensagem aqui","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6576,1920]},{"parameters":{"assignments":{"assignments":[{"id":"348694b3-260f-4b2f-be3d-60d717f2163b","name":"ID","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"id\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6688,1920],"id":"96644b01-766d-4c29-939c-aac3ae1652f2","name":"Edit Fields9"},{"parameters":{"method":"=POST","url":"={{ $('Webhook EVO').item.json.body.server_url }}/chat/getBase64FromMediaMessage/{{ $('Webhook EVO').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook EVO').item.json.body.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.ID }}\"\n    }\n  },\n  \"convertToMp4\": false\n} ","options":{"redirect":{"redirect":{}}}},"id":"7bdd077a-20b3-4f19-b361-10f323e1a4cb","name":"Coloque o ID da mensagem aqui1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6592,2096]},{"parameters":{"assignments":{"assignments":[{"id":"348694b3-260f-4b2f-be3d-60d717f2163b","name":"ID","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"id\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6704,2096],"id":"f011e89b-147d-4c3e-acec-5af906b6ffae","name":"Edit Fields10"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"etapa\"] }}","rightValue":"=2","operator":{"type":"string","operation":"equals"},"id":"06c02714-ea2d-45be-ab8d-4b6dd7a88648"}],"combinator":"and"},"renameOutput":true,"outputKey":"inicio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"aa0651f3-5089-4c07-9802-e287fbc791a4","leftValue":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"etapa\"] }}","rightValue":"3","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"soluçoes"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cb220f62-0697-47e9-87de-997094aa6832","leftValue":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"etapa\"] }}","rightValue":"4","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"objeçoes"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7e2dfd0e-5aaf-4ccc-847f-abd49fa8a096","leftValue":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"etapa\"] }}","rightValue":"5","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"dados"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fc5471e6-3962-4cb1-862a-b038fda648bf","leftValue":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"etapa\"] }}","rightValue":"6","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"reserva"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1192ecfc-ff14-4547-abec-3b2f9c3998e2","leftValue":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"etapa\"] }}","rightValue":"8","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"follow up"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d13a7440-2138-47bc-be70-6b1361c297d7","leftValue":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"etapa\"] }}","rightValue":"1","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"1"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-208,64],"id":"5564eb51-2e8d-40f1-9aa5-4f217b1a7e97","name":"Switch1"},{"parameters":{"method":"POST","url":"=https://api.clint.digital/v1/contacts/{{ $item(\"0\").$node[\"busca contato2\"].json[\"data\"][\"0\"][\"id\"] }}/tags","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api-token","value":"U2FsdGVkX18l0P9AMegoDYWWfaKpsds+BaA5FN8YJYY1LC0tJsywD0cjMPOmQKNU2CUUNB8aIxPQSJODPEPaiA=="}]},"sendBody":true,"specifyBody":"json","jsonBody":"[\"qualificado\"]","options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2256,0],"id":"f26d3ec0-963a-4af4-a7b5-bd6b80a69958","name":"atualiza tag2"},{"parameters":{"url":"https://crm.rdstation.com/api/v1/organizations","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2096,320],"id":"57453c99-a36a-40f1-a860-40c82a3512ec","name":"atualiza tag3"},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Supabase\"].json[\"telefone\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $json.arguments.nome }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-208,-384],"id":"955483d1-05fe-412a-abd0-9b5426641cb9","name":"nome","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"url":"https://crm.rdstation.com/api/v1/deal_sources","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"api-token","value":"U2FsdGVkX18l0P9AMegoDYWWfaKpsds+BaA5FN8YJYY1LC0tJsywD0cjMPOmQKNU2CUUNB8aIxPQSJODPEPaiA=="}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"tag_name","value":"etapa2"}]},"options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2080,16],"id":"366a04fd-06ff-4150-a514-f9e86a3007ad","name":"deltar tag1"},{"parameters":{"method":"POST","url":"=https://api.clint.digital/v1/deals/{{ $item(\"0\").$node[\"negocios\"].json[\"data\"][\"0\"][\"id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"api-token","value":"U2FsdGVkX18l0P9AMegoDYWWfaKpsds+BaA5FN8YJYY1LC0tJsywD0cjMPOmQKNU2CUUNB8aIxPQSJODPEPaiA=="}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"stage","value":"Reunião Agendada"},{"name":"status","value":"={{ $item(\"0\").$node[\"negocios\"].json[\"data\"][\"0\"][\"status\"] }}"}]},"options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2416,144],"id":"434679fd-bd09-42c7-bfb6-192a7802bf5d","name":"move negocio1"},{"parameters":{"method":"POST","url":"=https://api.clint.digital/v1/deals/{{ $item(\"0\").$node[\"negocios\"].json[\"data\"][\"0\"][\"id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"api-token","value":"U2FsdGVkX18l0P9AMegoDYWWfaKpsds+BaA5FN8YJYY1LC0tJsywD0cjMPOmQKNU2CUUNB8aIxPQSJODPEPaiA=="}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"stage","value":"Qualificação (SDR)"},{"name":"status","value":"={{ $item(\"0\").$node[\"negocios\"].json[\"data\"][\"0\"][\"status\"] }}"}]},"options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2416,16],"id":"34f1d7a2-1ae1-454d-8edb-58e4b4f3dcd4","name":"move negocio2"},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendText/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"=553192919794"},{"name":"text","value":"=cliente: {{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"pushName\"] }}   -  zap: {{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"numero\"] }}\n\n{{  $json.texto }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"d17bfc55-b363-4a2c-96b8-fa292756ffb9","name":"Envia MSG Texto","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-128,768]},{"parameters":{"method":"POST","url":"https://crm.rdstation.com/api/v1/deals?token=65cf63a700a768000df641b6","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"content-type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n \"deal\": {\n    \"name\": \"{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"pushName\"] }} (IA)\"\n  },\n  \"organization\": {\n    \"_id\": \"6841bcaa20009f001f172c91\"\n  },\n  \"contacts\": [\n    {\n      \"phones\": [\n        {\n          \"phone\": \"{{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"numero\"] }}\"\n        }\n      ],\n      \"name\": \"{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"pushName\"] }} (IA)\"\n    }\n  ]\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4992,2048],"id":"7eea7fe8-2131-4f8f-8f61-776d0476be5e","name":"HTTP Request4"},{"parameters":{"operation":"get","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-352,160],"id":"e9d9e8d8-387a-4b3a-a746-3d3bafb716b8","name":"Supabase3","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"method":"PUT","url":"=https://crm.rdstation.com/api/v1/deals/{{ $item(\"0\").$node[\"Supabase3\"].json[\"id_negociação\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"deal_stage_id\": \"65cf63fb0bc1ec0019d3470e\"\n}","options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[96,16],"id":"50e09705-4535-4065-9cc1-308daa24dc81","name":"atualiza etapa objeção"},{"parameters":{"method":"PUT","url":"=https://crm.rdstation.com/api/v1/deals/{{ $item(\"0\").$node[\"Supabase3\"].json[\"id_negociação\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"deal_stage_id\": \"65cf63fb0bc1ec0019d3470f\"\n}","options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[96,160],"id":"5d04fd4f-5aff-4756-9e27-7f9ecfbb1c68","name":"atualiza etapa proposta"},{"parameters":{"method":"PUT","url":"=https://crm.rdstation.com/api/v1/deals/{{ $item(\"0\").$node[\"Supabase3\"].json[\"id_negociação\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"deal_stage_id\": \"65cf63fb0bc1ec0019d34710\"\n}","options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[96,304],"id":"150bf7d7-9c1d-491f-b8a5-b6d8e977ae8c","name":"atualiza etapa reserva"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ /https:\\/\\/.*\\.(png|jpe?g)/i.test(encodeURI($item(\"0\").$node[\"Loop Over Items1\"].json[\"message\"])) }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true},"id":"7a4a4ba5-fbf0-4717-a434-04108255503b"}],"combinator":"and"},"renameOutput":true,"outputKey":"imagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"71b2b6c6-d3e9-4313-ab02-357589c81949","leftValue":"={{ $item(\"0\").$node[\"Loop Over Items1\"].json[\"message\"] }}","rightValue":".mp4","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"video"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c54ec455-cb71-4cd7-bd5f-9fc672a38d18","leftValue":"={{ $item(\"0\").$node[\"Loop Over Items1\"].json[\"message\"] }}","rightValue":".pdf","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"documento"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c4f4d548-b0fb-4118-9d8f-eeb9ae95dc36","leftValue":"={{ $item(\"0\").$node[\"Loop Over Items1\"].json[\"message\"] }}","rightValue":".mp3","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[400,1696],"id":"0c255a14-4749-46e0-b679-19eb777936b9","name":"respostas"},{"parameters":{"jsCode":"// NOVA FUNÇÃO ADICIONADA - Extrator de Links de Mensagens com Texto\nfunction extractLinkFromFormattedMessage(message) {\n    try {\n        // Regex para encontrar URLs em diferentes formatos de mensagem\n        const patterns = [\n            // Formato: **[Texto]** (https://url)\n            /\\*\\*\\[.*?\\]\\*\\*\\s*\\((https?:\\/\\/[^\\s\\)]+)\\)/g,\n            // Formato: [Texto] (https://url) \n            /\\[.*?\\]\\s*\\((https?:\\/\\/[^\\s\\)]+)\\)/g,\n            // Formato: (https://url)\n            /\\((https?:\\/\\/[^\\s\\)]+)\\)/g,\n            // URL direta\n            /(https?:\\/\\/[^\\s\\)]+)/g\n        ];\n        \n        for (const pattern of patterns) {\n            const matches = [...message.matchAll(pattern)];\n            if (matches.length > 0) {\n                // Pega o primeiro link encontrado e limpa caracteres indesejados\n                let url = matches[0][1];\n                url = url.replace(/[,\\.\\)]+$/, '');\n                \n                // Verificar se é uma URL de mídia válida\n                if (isValidURL(url)) {\n                    return {\n                        success: true,\n                        url: url,\n                        detectedType: detectFileType(url),\n                        method: 'formatted_message_extraction'\n                    };\n                }\n            }\n        }\n        \n        return null;\n    } catch (error) {\n        console.log(\"Erro na extração de link formatado:\", error);\n        return null;\n    }\n}\n\n// Extrator Específico para Tags de Mídia\n// Formato esperado: <imagem>url</imagem>, <video>url</video>, etc.\n\n// Mapeamento de tipos de mídia\nconst MEDIA_TYPES = {\n    'imagem': ['jpg', 'jpeg', 'png', 'webp', 'gif'],\n    'video': ['mp4', 'webm', 'avi', 'mov'],\n    'audio': ['mp3', 'wav', 'ogg', 'm4a'],\n    'documento': ['pdf', 'doc', 'docx']\n};\n\n// Função para detectar tipo de arquivo pela extensão\nfunction detectFileType(url) {\n    const extension = url.split('.').pop().toLowerCase();\n    \n    for (const [type, extensions] of Object.entries(MEDIA_TYPES)) {\n        if (extensions.includes(extension)) {\n            return type;\n        }\n    }\n    \n    return 'unknown';\n}\n\n// Função para validar URL\nfunction isValidURL(url) {\n    try {\n        // Verificar se é uma URL válida\n        const urlPattern = /^https:\\/\\/[^\\s<>\"'()]+\\.[a-zA-Z0-9]+$/i;\n        if (!urlPattern.test(url.trim())) {\n            return false;\n        }\n        \n        // Verificar se tem extensão de arquivo válida\n        const extension = url.split('.').pop().toLowerCase();\n        const allValidExtensions = Object.values(MEDIA_TYPES).flat();\n        \n        return allValidExtensions.includes(extension);\n    } catch (error) {\n        return false;\n    }\n}\n\n// Função para extrair conteúdo de qualquer tag de mídia\nfunction extractMediaFromTags(rawInput) {\n    try {\n        // Regex para capturar qualquer tag de mídia\n        const mediaTagRegex = /<(imagem|video|audio|documento|midia)>(.*?)<\\/\\1>/gi;\n        const matches = [...rawInput.matchAll(mediaTagRegex)];\n        \n        if (matches.length === 0) {\n            return null;\n        }\n        \n        // Processar todas as tags encontradas\n        const results = [];\n        \n        for (const match of matches) {\n            const tagType = match[1].toLowerCase();\n            const url = match[2].trim();\n            \n            if (isValidURL(url)) {\n                const detectedType = detectFileType(url);\n                \n                results.push({\n                    tagType: tagType,\n                    detectedType: detectedType,\n                    url: url,\n                    valid: true\n                });\n            } else {\n                results.push({\n                    tagType: tagType,\n                    url: url,\n                    valid: false,\n                    error: 'URL inválida'\n                });\n            }\n        }\n        \n        return results;\n    } catch (error) {\n        console.log(\"Erro na extração de tags:\", error);\n        return null;\n    }\n}\n\n// Função principal específica para tag <imagem>\nfunction extractImageURL(rawInput) {\n    try {\n        const imageTagRegex = /<imagem>(.*?)<\\/imagem>/i;\n        const match = rawInput.match(imageTagRegex);\n        \n        if (match && match[1]) {\n            const url = match[1].trim();\n            \n            if (isValidURL(url)) {\n                return {\n                    success: true,\n                    url: url,\n                    tipo: 'imagem',\n                    detectedType: detectFileType(url)\n                };\n            } else {\n                return {\n                    success: false,\n                    error: 'URL da imagem inválida',\n                    url: url\n                };\n            }\n        }\n        \n        return null;\n    } catch (error) {\n        console.log(\"Erro na extração de imagem:\", error);\n        return null;\n    }\n}\n\n// Código principal\ntry {\n    // Obter mensagem\n    const message = $item(\"0\").$node[\"respostas\"].json[\"message\"];\n    \n    if (!message || typeof message !== 'string') {\n        return { \n            error: \"Mensagem não encontrada ou formato inválido\",\n            hasMedia: false\n        };\n    }\n    \n    console.log(\"Processando mensagem:\", message);\n    \n    // NOVA VERIFICAÇÃO ADICIONADA - Tratar mensagens com links formatados\n    if (!message.includes('<imagem>') && !message.includes('<video>') && !message.includes('<audio>') && !message.includes('<documento>')) {\n        const linkResult = extractLinkFromFormattedMessage(message);\n        \n        if (linkResult && linkResult.success) {\n            // Mapear tipo para Evolution API\n            let evolutionType;\n            switch (linkResult.detectedType) {\n                case 'imagem':\n                    evolutionType = 'image';\n                    break;\n                case 'video':\n                    evolutionType = 'video';\n                    break;\n                case 'audio':\n                    evolutionType = 'audio';\n                    break;\n                case 'documento':\n                    evolutionType = 'document';\n                    break;\n                default:\n                    evolutionType = 'document';\n            }\n            \n            return {\n                hasMedia: true,\n                mediaType: evolutionType,\n                url: linkResult.url,\n                detectedType: linkResult.detectedType,\n                method: linkResult.method,\n                originalMessage: message,\n                info: \"Link extraído de mensagem formatada\"\n            };\n        }\n    }\n    \n    // Verificar especificamente se tem tag <imagem>\n    if (message.includes('<imagem>') && message.includes('</imagem>')) {\n        const imageResult = extractImageURL(message);\n        \n        if (imageResult) {\n            if (imageResult.success) {\n                return {\n                    hasMedia: true,\n                    mediaType: 'image', // Para Evolution API\n                    url: imageResult.url,\n                    tagType: imageResult.tipo,\n                    detectedType: imageResult.detectedType,\n                    method: 'image_tag_extraction',\n                    originalMessage: message\n                };\n            } else {\n                return {\n                    error: imageResult.error,\n                    hasMedia: false,\n                    debug: { \n                        url: imageResult.url,\n                        originalMessage: message \n                    }\n                };\n            }\n        }\n    }\n    \n    // Verificar outras tags de mídia\n    const mediaResults = extractMediaFromTags(message);\n    \n    if (mediaResults && mediaResults.length > 0) {\n        // Pegar primeira mídia válida\n        const validMedia = mediaResults.find(m => m.valid);\n        \n        if (validMedia) {\n            // Mapear tipo para Evolution API\n            let evolutionType;\n            switch (validMedia.detectedType) {\n                case 'imagem':\n                    evolutionType = 'image';\n                    break;\n                case 'video':\n                    evolutionType = 'video';\n                    break;\n                case 'audio':\n                    evolutionType = 'audio';\n                    break;\n                case 'documento':\n                    evolutionType = 'document';\n                    break;\n                default:\n                    evolutionType = 'document';\n            }\n            \n            return {\n                hasMedia: true,\n                mediaType: evolutionType,\n                url: validMedia.url,\n                tagType: validMedia.tagType,\n                detectedType: validMedia.detectedType,\n                method: 'media_tag_extraction',\n                allResults: mediaResults,\n                originalMessage: message\n            };\n        } else {\n            return {\n                error: \"Tags de mídia encontradas mas nenhuma URL válida\",\n                hasMedia: false,\n                debug: { \n                    results: mediaResults,\n                    originalMessage: message \n                }\n            };\n        }\n    }\n    \n    // Nenhuma tag de mídia encontrada\n    return {\n        hasMedia: false,\n        isTextOnly: true,\n        message: message,\n        info: \"Mensagem não contém tags de mídia\"\n    };\n    \n} catch (error) {\n    return {\n        error: `Erro no processamento: ${error.message}`,\n        hasMedia: false,\n        debug: { stack: error.stack }\n    };\n}"},"id":"4f07c2a4-8913-4730-b3a8-f3dc9fc3bffb","name":"extrai o link da imagem","type":"n8n-nodes-base.code","typeVersion":2,"position":[720,1536]},{"parameters":{"jsCode":"// Obtém o input atual\nconst input = $item(\"0\").$node[\"respostas\"].json[\"message\"];\n\n// Expressão regular que captura somente URLs que comecem com http(s) e terminem em .mp4\n// Note que [^\\s)]+ não permite espaços nem parênteses de fechamento até chegar em .mp4\nconst match = input.match(/(https?:\\/\\/[^)\\s]+\\.mp4)/);\n\n// Verifica se a URL foi encontrada e define o resultado\nif (match) {\n  return {\n    url: match[1] // Captura a URL limpa no grupo 1\n  };\n} else {\n  throw new Error(\"Nenhuma URL válida (iniciando com https:// e terminando em .mp4) foi encontrada no input.\");\n}\n"},"id":"9c60c42f-78e9-4aa2-a367-d45740eb4fd6","name":"extrai o link do video","type":"n8n-nodes-base.code","typeVersion":2,"position":[720,1664]},{"parameters":{"jsCode":"// Obtém o input atual\nconst input = $item(\"0\").$node[\"respostas\"].json[\"message\"];\n\n// Expressão regular para capturar apenas a URL que começa com https:// e termina com .pdf\nconst match = input.match(/https?:\\/\\/[^\\s<>\"]+\\.pdf/);\n\n// Verifica se a URL foi encontrada e define o resultado corretamente\nif (match) {\n  return {\n    url: match[0] // A URL extraída corretamente\n  };\n} else {\n  throw new Error(\"Nenhuma URL válida foi encontrada no input.\");\n}\n"},"id":"b9354f46-0e4f-403d-9fca-faa26ec9fa4e","name":"extrai o link do documento","type":"n8n-nodes-base.code","typeVersion":2,"position":[720,1776]},{"parameters":{"jsCode":"// Obtém o input atual\nconst input = $item(\"0\").$node[\"respostas\"].json[\"message\"];\n\n// Utiliza uma expressão regular para extrair a URL dentro da tag <audio>\nconst match = input.match(/https?:\\/\\/[^\\s<]+/);\n\n// Verifica se a URL foi encontrada e define o resultado\nif (match) {\n  return {\n    url: match[0] // A URL extraída, sem o parêntese ou tags\n  };\n} else {\n  throw new Error(\"Nenhuma URL foi encontrada no input.\");\n}\n"},"id":"1b19d3bc-0143-4dcc-82ae-179217ec0a03","name":"extrai o link do audio","type":"n8n-nodes-base.code","typeVersion":2,"position":[720,1904]},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendWhatsAppAudio/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"},{"name":"audio","value":"={{ $item(\"0\").$node[\"extrai o link do audio\"].json[\"url\"] }}"},{"name":"delay","value":"={{ (() => {   \nconst texto = $item(\"0\").$node[\"Loop Over Items1\"].json[\"message\"] || ''; // Captura o texto da mensagem   \nconst comprimento = texto.length; // Conta os caracteres    \nconst tempoPorCaractere = 70; // Tempo médio por caractere (em milissegundos)   \nreturn Math.round(comprimento * tempoPorCaractere); // Garante número inteiro \n})() }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"aee3b35a-c9a8-4f0c-adfc-245a21b3d073","name":"envia audio","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[880,1904]},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendMedia/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"},{"name":"media","value":"={{ $item(\"0\").$node[\"extrai o link do documento\"].json[\"url\"] }}"},{"name":"mediatype","value":"document"},{"name":"mimetype","value":"document/pdf"},{"name":"fileName","value":"cocoverdeturismos.pdf"}]},"options":{"redirect":{"redirect":{}}}},"id":"d46a1e5e-ed45-41bf-9f41-9158cc2358c9","name":"envia audio1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[880,1776]},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendMedia/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"},{"name":"media","value":"={{ $item(\"0\").$node[\"extrai o link da imagem\"].json[\"url\"] }}"},{"name":"mediatype","value":"image"},{"name":"mimetype","value":"image/png"}]},"options":{"redirect":{"redirect":{}}}},"id":"59bbff26-7a50-4de8-b709-a12e4818e4b5","name":"envia audio2","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[880,1536]},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendMedia/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"},{"name":"media","value":"={{ $item(\"0\").$node[\"extrai o link do video\"].json[\"url\"] }}"},{"name":"mediatype","value":"video"},{"name":"mimetype","value":"video/mp4"}]},"options":{"redirect":{"redirect":{}}}},"id":"7935dc6e-2acc-4f9a-b2ab-62ff77564d45","name":"envia audio3","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[880,1664]},{"parameters":{"url":"https://crm.rdstation.com/api/v1/deal_stages","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"options":{"response":{"response":{"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2096,160],"id":"771258a2-3f64-4db3-8369-97702e8b2edf","name":"rd staion negocios"},{"parameters":{"assignments":{"assignments":[{"id":"792fc39d-2783-4678-a67f-9f617c1374ce","name":"dados RAG:","value":"=\n\n\n### **Passeios Turísticos**\n\n**Viva experiências únicas com nossos Passeios Turísticos**\n\n* **Filtros de busca:**\n    * **Destinos:** Aquiraz, Canoa Quebrada, Cascavel, Cumbuco, Fortaleza, Jericoacoara, Lagoinha, Paraipaba, Trairi.\n    * **Faixa de preço por adulto:** R$50 — R$500.\n\n---\n\n### **Nossos Passeios**\nJericoacoara bate volta no mesmo dia\n**Jericoacoara bate volta no mesmo dia**\n* **Descrição:** Passeio para Jericoacora com ida e volta no mesmo dia.\n* **Capacidade:** 44 pessoas\n* **Duração:** 16:30h\n* **Valor:** A partir de R$159\nInformações e itinerário\nNeste passeio, conhecido como “bate e volta”, você poderá conhecer os principais pontos turísticos da vila mais charmosa do Brasil. Será um dia para recarregar as energias e fazer aquelas fotos incríveis. Depois é só postar, curtir, comentar e ainda “tirar uma onda” falando sobre a sensação de ter conhecido um dos lugares mais lindos do mundo.\nEntre os pontos visitados, destacamos: Árvore da Preguiça, Pedra Furada, Lagoa do Paraíso e a Vila de Jericoacoara.\nEsse passeio é ideal para você que deseja conhecer este paraíso, mas tem pouco tempo de estadia no Ceará. A saída de Fortaleza acontece às 3:00 da manhã, dependendo de onde você esteja hospedado, a partida pode variar até 4:30. O horário previsto de chegada em Jijoca de Jericoacoara é às 10:00. Na cidade, acontece a troca de carros (necessária por se tratar de uma área de preservação ambiental), onde você irá prosseguir em um veículo 4×4 para fazer o percurso das dunas, onde também há formação de lagoas naturais (Lagoa do Paraíso).\nDepois seguirá para o Lagun Beach (Lago Azul) e a Árvore da Preguiça na praia do Preá. Devido aos fortes ventos da região, essa famosa planta cresceu deitada, como quem está tirando uma soneca. Em seguida, o passeio segue em direção à Pedra Furada, onde há a realização de uma caminha ecológica. Em determinada época do ano, o sol se põe “dentro” da Pedra Furada.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans\nGuia turístico\nIda ao Lagun Beach (Lago Azul)\nVisita à Árvore da Preguiça\nVisita à Pedra Furada\nVisitação na Vila de Jericoacoara\nPasseio pelas Dunas de Jericoacoara (Famosas fronhas Cearenses)\nVisita à Lagoa do Paraíso\nO que não está incluído:\nPasseios opcionais que não estão descritos na programação\nImposto ambiental (R$ 41,50)\nTaxa de acesso ao Lagun Beach (R$ 30)\nTaxa de acesso ao Buraco Azul (R$ 30)\nAlimentação\nQualquer outro item não citado na oferta\n\nLocais de embarque: Os embarques acontecem em toda a orla marítima de Fortaleza: hotéis da Praia de Iracema, Avenida Beira Mar, Avenida Abolição e Praia do Futuro.\nHorários de embarque nos hotéis de Fortaleza:\nPraia do Futuro: 03:00h\nAvenida Beira Mar: 03:30h\nPraia de Iracema: 03:50h\nQue horas começa o passeio? O primeiro embarque acontece às 03:00 e o último às 04:00, pois às 05:00 inicia-se o percurso a caminho de Jericoacoara.\nQue horas o passeio termina? Aproximadamente às 18:00 acontece o retorno saindo de Jijoca de Jericoacoara para Fortaleza, com chegada prevista a partir de 23:30.\nRegras gerais: Consulte nossos termos e condições.\n\nFaça sua reserva\nPasseio para Jericoacoara com ida e volta no mesmo dia.\nDuração: 16:30h\nCapacidade: 44 pessoas\nValor: A partir de R$ 159,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n3 Praias em 1 Dia + passeio de buggy + Canoa Quebrada\n\n**3 Praias em 1 Dia + passeio buggy+ Canoa Quebrada**\n* **Descrição:** Conheça Morro Branco, Praia das Fontes e Canoa Quebrada com direito a passeio de Buggy.\n* **Capacidade:** 50 pessoas\n* **Duração:** 03:30h\n* **Valor:** R$170.00\n\n\nInformações e itinerário\nEsse passeio é perfeito para quem sempre sonhou em conhecer algumas das principais praias do Ceará e sua diversidade cultural. São tantas opções de lazer no estado, que esse passeio se tornou diferenciado e muito procurado por sua praticidade e comodidade.\nRoteiro do Passeio:\n07:00 horas:\n\n\nInício dos embarques a partir do Mercado Central, hotéis na Praia de Iracema, Praia do Meireles, Praia do Mucuripe e Praia do Futuro.\nChegada a Morro Branco:\n\n\nA primeira parada é na Associação dos Bugueiros para o passeio de buggy (incluso), que tem duração de 2h30m e percorre as belezas naturais e cenários paradisíacos entre as Praias de Morro Branco e Praia das Fontes.\nDurante o passeio, todos irão conhecer o Labirinto das Falésias, famoso por suas areias coloridas, em uma caminhada de 30 minutos.\n13:00 horas:\n\n\nChegada prevista em Canoa Quebrada, com parada de apoio na Barraca da Lua, onde você poderá usar toda a estrutura (a piscina tem um custo de R$ 10,00 por pessoa). Há opções de almoço Self Service ou A La Carte.\n16:00 horas:\n\n\nHorário previsto de retorno para Fortaleza. No caminho, haverá uma parada em um Engenho conhecido por ter a maior rapadura do mundo, além de aguardente e diversos doces para comprar como lembrança.\n19:00 horas:\n\n\nChegada prevista em Fortaleza, Ceará.\n(Observação: o roteiro pode ser invertido por causa da tábua das marés).\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nPasseio de buggy em Morro Branco e Praia das Fontes.\nO que não está incluído:\nPasseios opcionais.\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Embarques no Mercado Central e hotéis na Praia de Iracema, Praia do Meireles, Praia do Mucuripe e Praia do Futuro.\nHorários:\nPraia de Iracema: 07:00h\nAvenida Beira Mar: 07:30h\nPraia do Futuro: 07:50h\nQue horas começa e termina o passeio? O primeiro embarque é às 07:00h e o último às 07:50h. O retorno de Canoa Quebrada para Fortaleza é por volta das 16:00h.\nCancelamento: Consulte nossos termos e condições.\n\n    Faça sua reserva\nConheça Morro Branco, Praia das Fontes e Canoa Quebrada com direito a passeio de Buggy.\nDuração: 03:30h\nCapacidade: 50 pessoas\nValor: R$ 170,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n**Traslado para o Beach Park**\n* **Descrição:** Transfer para o Beach Park, ida e volta.\n* **Capacidade:** 50 pessoas\n* **Duração:** 03:30h\n* **Valor:** R$50.00\n\nTraslado para o Beach Park\nInformações e itinerário\nDescrição do traslado:\n09:00 horas:\n\n\nInício dos embarques no Hotel Marina Park, seguindo em direção ao Beach Park com chegada prevista por volta das 10:00h. Quem for para o parque terá toda sua estrutura. Quem ficar fora poderá acessar e usufruir da Barraca de Praia do próprio Beach Park.\n17:00 horas:\n\n\nInício do retorno, quando o Beach Park começa a fechar.\n18:30 horas:\n\n\nHorário previsto de chegada em Fortaleza.\nDias dos traslados:\n\n\nTodos os dias, exceto às quartas-feiras.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nO que não está incluído:\nPasseios opcionais.\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Embarques no Mercado Central e hotéis na Praia de Iracema, Praia do Meireles, Praia do Mucuripe e Praia do Futuro.\nHorários:\nPraia de Iracema: 09:00h\nAvenida Beira Mar: 09:30h\nPraia do Futuro: 09:50h\nQue horas começa o passeio? O primeiro embarque acontece às 09:00h e o último às 09:50h.\nCancelamento: Consulte nossos termos e condições.\n\nFaça sua reserva\nTransfer para o Beach Park, ida e volta.\nDuração: 03:30h\nCapacidade: 50 pessoas\nValor: R$ 50,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n\n**Praia de Flecheiras**\n* **Descrição:** Praia de Flecheiras com ida e volta no mesmo dia. (Atenção, este passeio ocorre somente nos dias de quarta, sexta e domingo).\n* **Capacidade:** 44 pessoas\n* **Duração:** 10:00h\n* **Valor:** R$100\n\n\nPraia de Flecheiras\nInformações e itinerário\nFlecheiras está localizada na cidade de Trairi, a 130 km de Fortaleza. É um importante destino turístico do litoral oeste do Ceará, que oferece belas paisagens, tranquilidade e sossego.\nA praia tem a forma de uma enseada e seu principal cartão postal são as piscinas naturais de águas claras que se formam por toda a orla durante a maré baixa.\nAtenção: Este passeio ocorre somente às quartas-feiras, sextas-feiras e domingos.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nDesembarque na Praia de Flecheiras.\nO que não está incluído:\nPasseios opcionais, como Buggy, quadriciclo, etc.\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Os embarques acontecem em hotéis localizados em toda a orla de Fortaleza (Praia de Iracema, Avenida Beira Mar, Meireles, Mucuripe e Praia do Futuro).\nHorário: Os embarques iniciam a partir das 7:00h.\nQue horas o passeio termina? A saída de Flecheiras para retornar a Fortaleza ocorre às 16:00h.\nRegras gerais: Consulte nossos termos e condições.\n\nFaça sua reserva\nPasseio para a Praia de Flecheiras com ida e volta no mesmo dia.\nDuração: 10:00h\nCapacidade: 44 pessoas\nValor: R$ 100 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n**Praia de Cumbuco**\n* **Descrição:** Passeio para a Praia de Cumbuco.\n* **Capacidade:** 44 pessoas\n* **Duração:** 12:30h\n* **Valor:** R$55.00\n\nPraia de Cumbuco\nInformações e itinerário\nO passeio acontece durante o dia inteiro para a Praia do Cumbuco, com saída pela manhã dos hotéis da orla de Fortaleza e retorno no final da tarde.\nUma ótima dica é o passeio opcional de buggy, que custa em torno de R$100 por pessoa ou R$400 pelo buggy fechado. Cada duna reserva uma aventura radical. Além disso, a região oferece outras opções de aventura, como quadriciclos, jangada, cavalo, jet-ski e banana-boat.\nRoteiro do Passeio:\n08:00 horas:\n\n\nInício do embarque na Praia do Futuro. O percurso segue em direção ao destino, chegando à Praia de Cumbuco por volta das 09:30h.\nA barraca de apoio é a CUMBUCO BEACH ou Chico do Caranguejo.\nHá a opção de passeio de Buggy (com duas horas de duração).\n16:00 horas:\n\n\nHorário de retorno para Fortaleza.\n17:00 horas:\n\n\nPrevisão de chegada em Fortaleza.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nO que não está incluído:\nPasseios opcionais.\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Os embarques acontecem em toda a orla marítima de Fortaleza (hotéis da Praia de Iracema, Avenida Beira Mar, Avenida Abolição e Praia do Futuro).\nHorários:\nPraia do Futuro: 08:00h\nAvenida Beira Mar: 08:30h\nPraia de Iracema: 08:50h\nQue horas começa e termina o passeio? O primeiro embarque é às 08:00h e o último às 08:50h. O retorno da Praia do Cumbuco para Fortaleza é às 16:00h.\nRegras gerais: Consulte nossos termos e condições.\n\nFaça sua reserva\nPasseio para a Praia de Cumbuco.\nDuração: 12:30h\nCapacidade: 44 pessoas\nValor: R$ 55,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n**Praia de Aguas Belas**\n* **Descrição:** Possiblidades de piscinas naturais de acordo com a tábua das marés.\n* **Capacidade:** 44 pessoas\n* **Duração:** 12:30h\n* **Valor:** R$75.00\n\nPraia de Águas Belas\nInformações e itinerário\nA Praia de Águas Belas está a 65 km de Fortaleza, localizada no município de Cascavel. É uma das mais bonitas praias da região, onde é possível contemplar o encontro do Rio Mal Cozinhado com o mar.\nRoteiro do Passeio:\n08:00 horas:\n\n\nInício dos embarques, seguindo em direção ao destino. No caminho, há uma parada nas \"Rendeiras\".\nA chegada na Praia de Águas Belas ocorre por volta das 10:00h.\nA barraca de apoio é a \"Meu Refúgio\".\nPasseio Opcional: Buggy por R$ 60,00 por pessoa (valor sujeito a alterações).\n16:00 horas:\n\n\nHorário de retorno para Fortaleza.\n18:00 horas:\n\n\nPrevisão de chegada em Fortaleza.\nDias do passeio: Terça-feira, quinta-feira e sábado.\n\n\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nDesembarque na Praia de Águas Belas.\nO que não está incluído:\nPasseios opcionais, como Buggy, quadriciclo, etc.\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Os embarques acontecem em toda a orla marítima de Fortaleza (hotéis da Praia de Iracema, Avenida Beira Mar, Avenida Abolição, Mucuripe e Praia do Futuro).\nHorário: Os embarques iniciam a partir das 8:00h.\nQue horas o passeio termina? A saída de Águas Belas para retornar a Fortaleza ocorre às 16:00h.\nRegras gerais: Consulte nossos termos e condições.\n\nFaça sua reserva\nAproveite as possibilidades de piscinas naturais de acordo com a tábua das marés.\nDuração: 12:30h\nCapacidade: 44 pessoas\nValor: R$ 75,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n**Praia de Lagoinha**\n* **Descrição:** Passeio completo para a Praia da Lagoinha, a 130 km de Fortaleza.\n* **Capacidade:** 48 pessoas\n* **Duração:** 12:30h\n* **Valor:** R$80.00\nraia de Lagoinha\nInformações e itinerário\nUma das praias mais bonitas do Ceará, a Praia de Lagoinha reserva uma natureza exuberante composta por dunas, falésias, coqueiros e lagoas.\nRoteiro do Passeio:\n07:30 horas:\n\n\nInício do embarque na Praia do Futuro, seguindo em direção ao destino com chegada na Praia de Lagoinha por volta das 10:30h.\nA barraca de apoio chama-se MANZUÁ e oferece piscina de frente para o mar.\nPasseio Opcional 3 em 1: Um passeio de aproximadamente duas horas que combina Pau de Arara, Catamarã e, por último, Buggy.\n16:00 horas:\n\n\nHorário de saída de Lagoinha para retornar a Fortaleza.\n18:30 horas:\n\n\nPrevisão de chegada em Fortaleza.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nDesembarque na Praia da Lagoinha.\nO que não está incluído:\nPasseios opcionais, como Buggy, quadriciclo, etc.\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Os embarques acontecem em toda a orla marítima de Fortaleza (hotéis da Praia de Iracema, Avenida Beira Mar, Avenida Abolição, Mucuripe e Praia do Futuro).\nHorário: Os embarques iniciam a partir das 7:30h.\nRegras gerais: Consulte nossos termos e condições.\n\nFaça sua reserva\nPasseio completo para a Praia da Lagoinha, a 130 km de Fortaleza.\nDuração: 12:30h\nCapacidade: 48 pessoas\nValor: R$ 80,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n**Canoa Quebrada direto**\n* **Descrição:** Passeio para Canoa Quebrada.\n* **Capacidade:** 50 pessoas\n* **Duração:** 03:30h\n* **Valor:** R$100\n\nCanoa Quebrada Direto\nInformações e itinerário\nCanoa Quebrada está localizada a 167 km de Fortaleza e é considerada uma das mais exóticas, paradisíacas, rústicas e primitivas praias do litoral cearense. Seu símbolo é a famosa meia-lua com a estrela.\nA vila possui uma rua principal, apelidada de \"Broadway\", que reúne toda a infraestrutura do local, como pousadas, bares, restaurantes e diversas opções de barracas de praia que servem os mais variados pratos típicos à base de frutos do mar.\nÉ possível ainda fazer passeios opcionais de buggy pelas dunas para conhecer melhor a região ou velejar em uma jangada típica.\nRoteiro do Passeio:\n07:00 horas: Início do embarque nos hotéis da Orla Marítima de Fortaleza.\n16:00 horas: Horário de retorno para Fortaleza.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nO que não está incluído:\nPasseios opcionais.\nAlimentação.\nBuggy.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Embarques no Mercado Central e em hotéis na Praia de Iracema, Praia do Meireles, Praia do Mucuripe e Praia do Futuro.\nHorários:\nPraia de Iracema: 07:00h\nAvenida Beira Mar: 07:30h\nPraia do Futuro: 07:50h\nQue horas começa e termina o passeio? O primeiro embarque é às 07:00h e o último às 07:50h. A saída de Canoa Quebrada para Fortaleza é por volta das 16:00h.\nCancelamento: Consulte nossos termos e condições.\n\nFaça sua reserva\nPasseio para Canoa Quebrada.\nDuração: 03:30h\nCapacidade: 50 pessoas\nValor: R$ 100 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n**Flecheiras, Mundaú e Catamarã**\n* **Descrição:** Flecheiras, Mundaú e Catamarã com passeio de barco incluso. (Atenção, este passeio ocorre somente nos dias de quarta, sexta e domingo).\n* **Capacidade:** 50 pessoas\n* **Duração:** 03:30h\n* **Valor:** R$185\n\nFlecheiras, Mundaú e Catamarã\nInformações e itinerário\nEste passeio combina a beleza de Flecheiras com o vilarejo de Mundaú, localizado na ponta do município de Trairi.\nA região é muito procurada para veraneio e possui vasta vegetação na costa, formando um verdadeiro oásis.\nAs paisagens incluem dunas de areias brancas, o encontro do rio Mundaú com o mar e lagoas, como a de Cabeceiras.\nÉ um importante destino turístico do litoral oeste do Ceará, que oferece tranquilidade e boa infraestrutura.\nPasseio de Barco Catamarã está INCLUSO.\nAtenção aos dias do passeio:\nObservação: O texto apresenta informações conflitantes sobre os dias em que o passeio ocorre. Uma parte menciona \"quarta, sexta e domingo\" e outra menciona \"segundas, quartas e sextas\". Recomenda-se confirmar o dia correto no momento da reserva.\n\nInformações Importantes:\nO embarque e desembarque dos passeios sempre ocorrem na orla de Fortaleza.\nTodos os passeios são realizados em vans, micro-ônibus ou ônibus climatizados, designados de acordo com o número de passageiros.\nPara seu maior conforto, os clientes deverão aguardar na recepção do hotel a partir dos horários indicados.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nPasseio de catamarã.\nO que não está incluído:\nPasseios opcionais.\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nLocais: Embarques no Mercado Central e em hotéis na Praia de Iracema, Praia do Meireles, Praia do Mucuripe e Praia do Futuro.\nHorários:\nPraia do Futuro: 07:00h\nAvenida Beira Mar: 07:30h\nPraia de Iracema: 07:45h\nQue horas começa o passeio? O primeiro embarque acontece às 07:00h e o último às 07:50h, pois às 08:00h inicia-se o percurso.\nCancelamento: Para informações sobre cancelamento, consulte nossos termos e condições.\n\nFaça sua reserva\nFlecheiras, Mundaú e Catamarã com passeio de barco incluso.\nDuração: 03:30h\nCapacidade: 50 pessoas\nValor: R$ 185 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n**buggy Fortaleza x praia do Cumbuco**\n* **Descrição:** Passeio de buggy para a praia do Cumbuco.\n* **Capacidade:** 4 pessoas\n* **Duração:** 03:30h\n* **Valor:** R$500.00\n\nBuggy Fortaleza x Praia do Cumbuco\nInformações e itinerário\nEste é um passeio privativo de buggy, com capacidade para 1 a 4 pessoas, realizado por bugueiros credenciados.\nRoteiro do Passeio:\nSaída: O passeio começa com a saída do hotel em Fortaleza.\nParada Opcional: Parada em um mercadinho para compra de bebidas.\nTrajeto: O percurso até o Cumbuco é feito via asfalto.\nLagoa do Cauípe: Chegando ao Cumbuco, a primeira parada é na Lagoa do Cauípe (conhecida como o \"Paraíso do Kite Surf\") para fotos e banho.\nDunas: O passeio segue para as dunas (com ou sem emoção), com paradas para fotos e para as atividades opcionais de Toboágua e \"Skybunda\".\nLagoa do Banana: Próxima parada na Lagoa do Banana, com opções de Jet Ski, Banana Boat e Tirolesa.\nBarraca de Praia: A última parada é em uma barraca de praia para almoço, onde também há opções de passeios de quadriciclo, jegue, jangada e cavalo.\nRetorno: O retorno para Fortaleza ocorre no final da tarde.\n(Observação: Todas as atividades como toboágua, jet ski, etc., são pagas à parte, custando em média R$ 20 por brinquedo).\n\nValores:\nValor do Buggy: R$ 500,00 para até 4 pessoas.\nFormas de Pagamento: R$ 500,00 em até 3x sem juros ou R$ 485,00 no PIX.\nTaxa Adicional: Embarque na Praia do Futuro tem um acréscimo de R$ 50,00 por buggy.\n\nO que está incluído:\nPasseio de buggy.\nGuia turístico.\nParada nas dunas, passando por duas lagoas, esquibunda e toboágua.\nO que não está incluído:\nAlimentação.\nPasseios e atividades opcionais.\n\nLocais e horários de embarque:\nLocais: Hotéis em Mucuripe, Praia do Meireles e Praia de Iracema.\nHorários: O texto apresenta horários de partida variados (a partir das 8:00h, 8:30h ou 9:00h). Recomenda-se confirmar o horário exato no momento da reserva.\nRetorno: O retorno ocorre entre 15:00h e 16:00h.\nCancelamento: Consulte nossos termos e condições.\n\nFaça sua reserva\nPasseio de buggy para a Praia do Cumbuco.\nDuração: 03:30h\nCapacidade: 4 pessoas\nValor: R$ 500 por buggy\nInformações para reserva:\nNúmero de Veículos\nEscolha uma data\nEndereço do hotel/pousada\n\n\n**Passeio de buggy em Aquiraz CE**\n* **Descrição:** Passeio de buggy pela praia de Aquiraz, CE.\n* **Capacidade:** 4 pessoas\n* **Duração:** 02:30h\n* **Valor:** R$500.00\n\n\n**Passeio lado leste Jericoacoara comp 4×4**\n* **Descrição:** Passeio lado leste de Jericoacoara em veículo 4x4.\n* **Capacidade:** 40 pessoas\n* **Valor:** R$80.00\nPasseio Lado Leste de Jericoacoara em 4x4\nInformações e itinerário\nEste passeio de 4x4 explora os principais pontos do lado leste de Jericoacoara.\nPontos visitados:\nLagoa do Paraíso\nÁrvore da Preguiça\nVilarejo de Jericoacoara\nParadas Opcionais (com taxa de entrada):\nAlchymist Beach Club: Entrada de R$ 30,00.\nLagun Beach (Lago Azul): Traslado com taxa de R$ 30,00.\nBuraco Azul: Traslado com taxa de R$ 30,00.\n\nFaça sua reserva\nPasseio pelo lado leste de Jericoacoara em veículo 4x4.\nCapacidade: 40 pessoas\nValor: R$ 80,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n**Passeio de buggy lado oeste Jericoacoara**\n* **Descrição:** Conheça o lado oeste de Jericoacoara, o lado mais aventureiro do Ceará.\n* **Capacidade:** 4 pessoas\n* **Valor:** R$500.00\n\nPasseio de Buggy: Lado Oeste de Jericoacoara\nConheça o lado oeste de Jericoacoara, considerado o lado mais aventureiro do Ceará, em um roteiro que combina emoção, paisagens deslumbrantes e momentos de tranquilidade.\nInformações Gerais do Passeio:\nValor: R$ 500,00 por adulto\nCapacidade: 4 pessoas por buggy\nHorário: Saída de Jericoacoara a partir das 9:00h, com retorno às 15:00h.\n\nItinerário Detalhado\nManhã:\nSaída de Jericoacoara (9h): O passeio começa com o motorista guiando pelas dunas de areia, garantindo um início emocionante para a sua aventura.\n\n\nPrimeira Parada: Praia do Mangue Seco: Após a primeira etapa pelas dunas, você fará uma parada na Praia do Mangue Seco. É o momento ideal para tirar fotos nas famosas redes sobre as águas tranquilas e relaxar no cenário paradisíaco.\n\n\nTravessia do Rio Guriú (10h30): A aventura continua com a travessia do Rio Guriú em uma balsa, uma experiência única. Após a travessia, há um passeio de barco opcional para observar cavalos-marinhos em seu habitat natural.\n\n\nTarde:\nDunas e Lago Grande (12h): O buggy segue para as imponentes dunas brancas, onde você pode praticar skibunda ou simplesmente apreciar a vista panorâmica. A próxima parada é o Lago Grande, um oásis de águas transparentes, perfeito para um mergulho refrescante.\n\n\nAlmoço em Tatajuba: O passeio leva você à vila de Tatajuba para o almoço. Lá, restaurantes rústicos oferecem deliciosas opções de frutos do mar, que podem ser saboreados em frente à lagoa em um clima tranquilo.\n\n\nPraia de Tatajuba: Após o almoço, aproveite para relaxar na Praia de Tatajuba, um local de beleza natural exuberante e quase deserto, ideal para um descanso ou um banho em águas calmas.\n\n\nRetorno a Jericoacoara (15h): O passeio é finalizado com o retorno ao ponto de partida em Jericoacoara, proporcionando uma última aventura pelas dunas e, com sorte, a chance de apreciar um pôr do sol inesquecível.\n\n\nEste roteiro proporciona uma experiência completa e memorável do lado oeste de Jericoacoara.\n\n\n\n\n**Jericoacoara Bate volta Saindo Aquiraz CE**\n* **Descrição:** Você terá a oportunidade de desfrutar de maravilhosos passeios para a praia de Jericoacoara.\n* **Capacidade:** 50 pessoas\n* **Duração:** 18:00h\n* **Valor:** R$230.00\n\nJericoacoara Bate e Volta - Saída de Aquiraz\nInformações e itinerário\nNeste passeio, conhecido como “bate e volta”, você poderá conhecer os principais pontos turísticos da vila mais charmosa do Brasil. Será um dia para recarregar as energias e fazer fotos incríveis.\nEntre os pontos visitados, destacamos: Árvore da Preguiça, Pedra Furada, Lagoa do Paraíso e a Vila de Jericoacoara.\nEsse passeio é ideal para você que deseja conhecer este paraíso, mas tem pouco tempo de estadia no Ceará. A saída ocorre de madrugada, com chegada prevista em Jijoca de Jericoacoara às 10:00h. Na cidade, acontece a troca de veículos (necessária por ser uma área de preservação ambiental), onde você seguirá em um 4×4 para fazer o percurso das dunas e lagoas.\nO roteiro segue para o Lagun Beach (Lago Azul), Árvore da Preguiça na Praia do Preá e a Vila de Jericoacoara. Depois, o passeio continua em direção à Pedra Furada, onde há uma caminhada ecológica.\n\nO que está incluído:\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nIda ao Lagun Beach (Lago Azul).\nVisita à Árvore da Preguiça.\nVisita à Pedra Furada.\nVisitação na Vila de Jericoacoara.\nPasseio pelas Dunas de Jericoacoara.\nVisita à Lagoa do Paraíso.\nO que não está incluído:\nPasseios opcionais não descritos na programação.\nTaxa ambiental (R$ 30,00).\nTaxa de acesso ao Buraco Azul (R$ 20,00).\nAlimentação.\nQualquer outro item não citado na oferta.\n\nLocais e horários de embarque:\nEste passeio oferece embarques em Aquiraz e Fortaleza.\nEmbarque em Aquiraz:\n\n\nA partir das 02:30h da manhã.\nEmbarques em Fortaleza:\n\n\nPraia do Futuro: 03:00h\nAvenida Beira Mar: 03:30h\nPraia de Iracema: 03:50h\nQue horas o passeio termina? O retorno de Jijoca de Jericoacoara para Fortaleza acontece aproximadamente às 18:00h, com chegada prevista a partir de 23:30h.\nRegras gerais: Consulte nossos termos e condições.\n\nFaça sua reserva\nVocê terá a oportunidade de desfrutar de maravilhosos passeios para a praia de Jericoacoara.\nDuração: 18:00h\nCapacidade: 50 pessoas\nValor: R$ 230,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n\n**3 Praias s/ buggy (Morro branco, P. fontes, Canoa Quebrada)**\n* **Descrição:** Vem viver essa emoção! Praia de Morro Branco, Praia das Fontes e Canoa Quebrada.\n* **Capacidade:** 50 pessoas\n* **Valor:** R$80\n3 Praias sem Buggy: Morro Branco, Praia das Fontes e Canoa Quebrada\nInformações e itinerário\nInício: 07:00h\nRetorno: 16:00h\nDuração do Passeio: Aproximadamente 8 horas.\nTipo de Transporte: Van, Micro-Ônibus ou Ônibus.\nObservações:\nEste é um passeio de dia inteiro, com saídas de qualquer hotel na orla marítima de Fortaleza ou do Praiano Hotel (próximo ao Clube Náutico).\nA saída do Praiano Hotel ocorre a partir das 7:20h, com retorno às 16:00h.\nDescrição do Passeio:\nO roteiro inicia pelo Litoral Leste. A primeira parada é em Morro Branco (a 85 km de Fortaleza), onde os visitantes podem conhecer a principal característica do local: as falésias com suas areias coloridas. Essa visita pode ser feita através de uma caminhada ou por um passeio de buggy (opcional, não incluso).\nEm seguida, o passeio continua até um mirante com vista para a Praia das Fontes, conhecida por suas bicas de água semi-mineral que brotam das falésias.\nPor fim, a terceira e última parada é em Canoa Quebrada. Na chegada, você será direcionado a uma barraca de praia com toda a infraestrutura. O restante do tempo será livre para curtir a praia, tomar um banho de mar e saborear a maravilhosa culinária local.\n\nFaça sua reserva\nVem viver essa emoção! Visite a Praia de Morro Branco, a Praia das Fontes e Canoa Quebrada.\nCapacidade: 50 pessoas\nValor: R$ 80 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n\n\n**Jericoacoara bate volta Vip**\n* **Descrição:** Você conhecerá o melhor de Jericoacoara VIP. Com esse roteiro, você consegue aproveitar o melhor do Lado Leste de Jericoacoara em um único dia.\n* **Capacidade:** 50 pessoas\n* **Valor:** R$279\n\nJericoacoara Bate e Volta VIP\nInformações e itinerário\nCom este roteiro, você consegue aproveitar o melhor do Lado Leste de Jericoacoara em um único dia, voltando para Fortaleza com memórias inesquecíveis dessa vila encantadora!\n\nO que está incluído no pacote VIP:\nTransporte:\n\n\nTranslado de ida e volta (Fortaleza a Jijoca de Jericoacoara) em ônibus executivo com poltronas acolchoadas e ar condicionado.\nPasseios locais em caminhonete 4x4.\nPasseios e Entradas:\n\n\nLagoa do Paraíso.\nLagun Beach (Entrada Inclusa).\nBuraco Azul (Entrada Inclusa).\nAlchymist Beach Club (Entrada Inclusa).\nVisita à Árvore da Preguiça.\nCaminhada ecológica à Pedra Furada.\nPôr do Sol nas Dunas.\nVisita à Vila de Jericoacoara.\nAcompanhamento:\n\n\nGuia de Turismo.\n\nO que não está incluído:\nTaxa Ambiental: R$ 41,50 por pessoa (valor pago diretamente à Prefeitura de Jericoacoara).\nTempo de permanência (aproximado):\nAlchymist Beach Club: 2 horas.\nLagun Beach: 1 hora.\nBuraco Azul: 1 hora.\n\nFaça sua reserva\nCapacidade: 50 pessoas\nValor: R$ 279,00 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nEndereço do hotel/pousada\n\n\n\n---\n\n### **Pacotes Turísticos**\n\n**Conheça lugares inesquecíveis com os nossos Pacotes Turísticos**\n\n* **Filtros de busca:**\n    * **Destinos:** Aquiraz, Canoa Quebrada, Cascavel, Cumbuco, Fortaleza, Jericoacoara, Lagoinha, Paraipaba, Trairi.\n    * **Quantidade de pessoas:** 0 a 50.\n    * **Faixa de preço:** R$149 — R$1.299.\n\n---\n\n### **As melhores opções em Hotéis e Pousadas!**\n\n**3 dias e 2 noites em Jericoacoara com Piscina**\n* **Descrição:** Pacote de 3 dias e 2 noites em Jericoacoara em hospedagem com piscina e café da manhã inclusos.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Com piscina.\n* **Valor:** Por R$ 1.299,00\n\nPacote: 3 dias e 2 noites em Jericoacoara com Piscina\nDesfrute das incríveis belezas de Jericoacoara com este pacote completo, que inclui 3 dias e 2 noites em Jeri com hospedagem, café da manhã e piscina.\n\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem com Piscina\nTraslado incluso\n\nO que está incluso no pacote?\nTraslado: Ida e volta de Fortaleza à Jijoca de Jericoacoara em ônibus executivo com poltronas acolchoadas e ar condicionado.\nPasseio Lado Leste: Passeio de Caminhonete 4x4 realizado no primeiro dia, visitando:\nLagoa do Paraíso\nÁrvore da Preguiça\nCaminhada ecológica à Pedra Furada\nPôr do Sol na Vila de Jericoacoara\nGuia de Turismo: Acompanhamento durante os passeios.\nO que não está incluso / Opcionais:\nTaxa Ambiental: R$ 30,00 (não incluso).\nLagun Beach (Lago Azul): O traslado é feito, mas a entrada é opcional e custa R$ 30,00.\nAtenção: Os valores não são válidos para datas comemorativas e períodos de férias.\n\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 4:30h da manhã.\n\nInformações Adicionais:\nNão encontrou o pacote ideal? Entre em contato com nossa equipe para montar um plano personalizado para você.\nRegras Gerais: Consulte nossos termos e condições para a reserva.\n\nFaça sua reserva\nValor: R$ 1.299,00\nInformações para reserva:\nNome\nData de Check-in\nEndereço do local de embarque\n\n\n\n**Pacote 2 Dias 1 Noite em Jericoacoara com Piscina**\n* **Descrição:** Pacote de 2 dias e uma noite em Jericoacoara em hospedagem com piscina e café da manhã inclusos.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Com piscina.\n* **Valor:** Por R$ 850,00\n\nPacote: 2 Dias e 1 Noite em Jericoacoara com Piscina\nExplore as Maravilhas do Paraíso Cearense\nDesfrute das incríveis belezas de Jericoacoara com este pacote completo! 2 dias e 1 noite em Jeri com hospedagem que inclui café da manhã e piscina.\n\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem com Piscina\nTraslado incluso\n\nO que está incluso no pacote?\nTraslado: Ida e volta de Fortaleza à Jijoca de Jericoacoara em ônibus executivo com poltronas acolchoadas e ar condicionado.\nPasseio Lado Leste: Passeio de Caminhonete 4x4 realizado no primeiro dia, visitando:\nLagoa do Paraíso\nÁrvore da Preguiça\nCaminhada ecológica à Pedra Furada\nPôr do Sol na Vila de Jericoacoara\nGuia de Turismo: Acompanhamento durante os passeios.\nO que não está incluso / Opcionais:\nTaxa Ambiental: R$ 30,00 (não incluso).\nLagun Beach (Lago Azul): O traslado é feito, mas a entrada é opcional e custa R$ 30,00.\nAtenção: Os valores não são válidos para datas comemorativas e períodos de férias.\n\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 3:00h da manhã.\n\nInformações Adicionais:\nNão encontrou o pacote ideal? Entre em contato com nossa equipe para montar um plano personalizado para você.\nRegras Gerais: Consulte nossos termos e condições para a reserva.\n\nFaça sua reserva\nValor: R$ 850,00\nInformações para reserva:\nNome\nData de Check-in\nEndereço do local de embarque\n\n\n\n**Pacote 3 dias e 2 noites em Jericoacoara sem Piscina**\n* **Descrição:** Pacote de 3 dias e 2 noites em Jericoacoara em hospedagem com café da manhã incluso e sem piscina.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Sem piscina.\n* **Valor:** Por R$ 999,00\n\nPacote: 3 dias e 2 noites em Jericoacoara sem Piscina\nDesfrute das incríveis belezas de Jericoacoara com este pacote completo! 3 dias e 2 noites em Jeri com hospedagem que inclui café da manhã.\n\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem sem Piscina\nTraslado incluso\n\nO que está incluso no pacote?\nTraslado: Ida e volta de Fortaleza à Jijoca de Jericoacoara em ônibus executivo com poltronas acolchoadas e ar condicionado.\nPasseio Lado Leste: Passeio de Caminhonete 4x4 realizado no primeiro dia, visitando:\nLagoa do Paraíso\nÁrvore da Preguiça\nCaminhada ecológica à Pedra Furada\nPôr do Sol na Vila de Jericoacoara\nGuia de Turismo: Acompanhamento durante os passeios.\nO que não está incluso / Opcionais:\nTaxa Ambiental: R$ 30,00 (não incluso).\nLagun Beach (Lago Azul): O traslado é feito, mas a entrada é opcional e custa R$ 30,00.\nAtenção:\nOs preços dependem da disponibilidade das pousadas.\nOs valores não são válidos para datas comemorativas e períodos de alta temporada.\nSugestão: Os melhores preços são encontrados para estadias entre domingo e quinta-feira.\n\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 3:00h da manhã.\n\nInformações Adicionais:\nNão encontrou o pacote ideal? Entre em contato com nossa equipe para montar um plano personalizado para você.\nRegras Gerais: Consulte nossos termos e condições para a reserva.\n\nFaça sua reserva\nValor: R$ 999,00\nInformações para reserva:\nNome\nData de Check-in\nEndereço do local de embarque\n\n\n\n\n\n**Pacote 2 dias e 1 noite em Jericoacoara sem Piscina**\n* **Descrição:** Pacote de 2 dias e uma noite em Jericoacoara em hospedagem com café da manhã incluso. Pacote válido apenas para dias de semana.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Sem piscina.\n* **Valor:** Por R$ 750,00\n\nPacote: 2 dias e 1 noite em Jericoacoara sem Piscina\nDesfrute das incríveis belezas de Jericoacoara com este pacote completo! 2 dias e 1 noite em Jeri com hospedagem que inclui café da manhã.\n\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem sem Piscina\nTraslado incluso\n\nO que está incluso no pacote?\nTraslado: Ida e volta de Fortaleza à Jijoca de Jericoacoara em ônibus executivo com poltronas acolchoadas e ar condicionado.\nPasseio Lado Leste: Passeio de Caminhonete 4x4 realizado no primeiro dia, visitando:\nLagoa do Paraíso\nÁrvore da Preguiça\nCaminhada ecológica à Pedra Furada\nPôr do Sol na Vila de Jericoacoara\nGuia de Turismo: Acompanhamento durante os passeios.\nO que não está incluso / Opcionais:\nTaxa Ambiental: R$ 30,00 (não incluso).\nLagun Beach (Lago Azul): O traslado é feito, mas a entrada é opcional e custa R$ 30,00.\nAtenção: Este pacote é válido apenas para dias de semana.\n\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 4:30h da manhã.\n\nInformações Adicionais:\nNão encontrou o pacote ideal? Entre em contato com nossa equipe para montar um plano personalizado para você.\nRegras Gerais: Consulte nossos termos e condições para a reserva.\n\nFaça sua reserva\nValor: R$ 750,00\nInformações para reserva:\nNome\nData de Check-in\nEndereço do local de embarque\n\n\n\n**2 dias e 1 noite em Canoa Quebrada sem Piscina**\n* **Descrição:** Pacote de 2 dias e uma noite em Canoa Quebrada em hospedagem com café da manhã incluso. Pacote válido apenas para dias de semana.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Sem piscina.\n* **Valor:** Por R$ 650,00\n\nacote: 2 dias e 1 noite em Canoa Quebrada sem Piscina\nDesfrute das incríveis belezas com este pacote completo! 2 dias e 1 noite em Jeri com hospedagem que inclui café da manhã.\nO que está incluso no pacote?\nTraslado de ida e volta Fortaleza à Jijoca de Jericoacoara;\nÔnibus executivo com poltronas acolchoadas e ar condicionado;\nPasseio de Caminhonete 4×4 para Lagoa do Paraíso, Árvore da Preguiça, caminhada ecológica à Pedra Furada, Pôr do Sol na Vila de Jericoacoara;\nTraslado até o Lagun Beach (lago azul), com entrada opcional de R$20,00;\nGuia de turismo;\nLagoa do Paraíso.\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem sem Piscina\nTraslado incluso\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 4:30h da manhã.\nAtenção: Pacote válido apenas para dias de semana.\nValor: R$ 650,00\n\n\n\n**3 dias e 2 noites em Canoa Quebrada sem Piscina**\n* **Descrição:** Pacote de 3 dias e 2 noites em Canoa Quebrada em hospedagem com café da manhã incluso e sem piscina.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Sem piscina.\n* **Valor:** Por R$ 900,00\n\nPacote: 3 dias e 2 noites em Canoa Quebrada sem Piscina\nDesfrute das incríveis belezas de Jericoacoara com este pacote completo! 3 dias e 2 noites em Jeri com hospedagem que inclui café da manhã.\nO que está incluso no pacote?\nTraslado de ida e volta Fortaleza à Jijoca de Jericoacoara;\nÔnibus executivo com poltronas acolchoadas e ar condicionado;\nPasseio de Caminhonete 4×4 para Lagoa do Paraíso, Árvore da Preguiça, caminhada ecológica à Pedra Furada, Pôr do Sol na Vila de Jericoacoara;\nTraslado até o Lagun Beach (lago azul), com entrada opcional de R$20,00;\nGuia de turismo;\nLagoa do Paraíso.\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem sem Piscina\nTraslado incluso\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 4:30h da manhã.\nValor: R$ 900,00\n\n\n\n**2 dias e 1 noite em Canoa Quebrada com Piscina**\n* **Descrição:** Pacote de 2 dias e uma noite em Canoa Quebrada em hospedagem com piscina e café da manhã inclusos.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Com piscina.\n* **Valor:** Por R$ 850,00\n\nPacote: 2 dias e 1 noite em Canoa Quebrada com Piscina\nDesfrute das incríveis belezas de Jericoacoara com este pacote completo! 2 dias e 1 noite em Jeri com hospedagem que inclui café da manhã e piscina.\nO que está incluso no pacote?\nTraslado de ida e volta Fortaleza à Jijoca de Jericoacoara;\nÔnibus executivo com poltronas acolchoadas e ar condicionado;\nPasseio de Caminhonete 4×4 para Lagoa do Paraíso, Árvore da Preguiça, caminhada ecológica à Pedra Furada, Pôr do Sol na Vila de Jericoacoara;\nTraslado até o Lagun Beach (lago azul), com entrada opcional de R$20,00;\nGuia de turismo;\nLagoa do Paraíso.\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem com Piscina\nTraslado incluso\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 4:30h da manhã.\nValor: R$ 850,00\n\n\n\n\n**3 dias e 2 noites em Canoa Quebrada com Piscina**\n* **Descrição:** Pacote de 3 dias e 2 noites em Canoa Quebrada em hospedagem com piscina e café da manhã inclusos.\n* **Inclui:** Passeios, Até 2 pessoas, Café da manhã, Traslado, Guia turístico, Com piscina.\n* **Valor:** Por R$ 950,00\n\nPacote: 3 dias e 2 noites em Canoa Quebrada com Piscina\nDesfrute das incríveis belezas de Jericoacoara com este pacote completo! 3 dias e 2 noites em Jeri com hospedagem que inclui café da manhã e piscina.O que está incluso no pacote?\nTraslado de ida e volta Fortaleza à Jijoca de Jericoacoara;\nÔnibus executivo com poltronas acolchoadas e ar condicionado;\nPasseio de Caminhonete 4×4 para Lagoa do Paraíso, Árvore da Preguiça, caminhada ecológica à Pedra Furada, Pôr do Sol na Vila de Jericoacoara;\nTraslado até o Lagun Beach (lago azul), com entrada opcional de R$20,00;\nGuia de turismo;\nLagoa do Paraíso.\nResumo do Pacote:\nPasseios turísticos\nPara até 2 pessoas\nCafé da manhã incluso\nGuia turístico incluso\nHospedagem com Piscina\nTraslado incluso\nInformações de Embarque:\nLocais: O embarque ocorre em 90% da rede hoteleira de Fortaleza, incluindo hotéis na Praia de Iracema, Praia do Futuro, Praia do Mucuripe e Praia do Meireles.\nHorário: A partir das 4:30h da manhã.\nAtenção: Os valores não são válidos para datas comemorativas e períodos de férias.\nValor: R$ 1.250,00\n\n\n---\n\n### **Traslados e Recepções**\n\n**Mais conforto e comodidade com nossos Traslados e Recepções**\n\n---\n\n#### **Nossas Opções de Traslado**\n\n**Traslado Fortaleza para Jericoacoara Regular**\n* **Descrição:** Translado compartilhado de Fortaleza para Jericoacoara em ônibus ou micro-ônibus com ar-condicionado. As saídas ocorrem a partir das 7h, com chegada prevista na vila de Jericoacoara às 13h. O custo médio por passageiro inclui a jardineira de Jijoca para Jericoacoara.\n\n* **Valor:** R$140\n\nTraslado Fortaleza para Jericoacoara (Regular)\nInformações e Itinerário\nEste serviço de traslado compartilhado para Jericoacoara é realizado diariamente em ônibus ou micro-ônibus com ar-condicionado.\nProcesso: O veículo segue de Fortaleza até Jijoca de Jericoacoara, onde ocorre a troca para um veículo 4x4 (tipo \"jardineira\", já incluso no valor) para fazer o trecho final até a vila.\nChegada: A previsão de chegada na vila de Jericoacoara é por volta das 13:00h.\nLocais e Horários de Embarque:\nOs embarques ocorrem em hotéis localizados nos seguintes bairros de Fortaleza:\nPraia do Futuro: a partir das 7:00h\nPraia do Meireles: a partir das 7:30h\nPraia de Iracema: a partir das 7:50h\n(O período total de embarques se encerra às 8:00h para o início da viagem).\n\nFaça sua reserva\nDuração da viagem: Aproximadamente 05:00h\nValor: R$ 140 por adulto\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nLocal de Embarque\n\n\n\n\n**Traslado Fortaleza para Jericoacoara**\n* **Descrição:** Traslado de Fortaleza para Jericoacoara ou de Jericoacoara para Fortaleza.\n\n* **Capacidade:** pago 130 por pessoa\n* **Valor:** R$130\n\nTraslado Fortaleza para Jericoacoara\nInformações e Itinerário\nEste serviço oferece duas opções: um traslado de ida de Fortaleza para Jericoacoara que inclui um tour, e um traslado de retorno direto.\n\n1. Traslado de IDA: Fortaleza para Jericoacoara (com Passeio Lado Leste)\nEste é um traslado compartilhado em ônibus executivo que, antes de chegar na sua pousada em Jericoacoara, realiza o passeio do Lado Leste.\nProcesso: O ônibus vai de Fortaleza até Jijoca. Por volta das 10:00h, ocorre a troca para um veículo 4x4 para iniciar o tour. Após a conclusão dos passeios, o veículo 4x4 realiza o desembarque na sua pousada na vila de Jericoacoara (chegada por volta das 15:00h).\nPasseios Inclusos na Ida:\nLagoa do Paraíso\nCaminhada da Pedra Furada\nTraslado para o Lagun Beach (lago azul)\nÁrvore da Preguiça\nValor (só ida): R$ 130,00 por pessoa.\n\n2. Traslado de RETORNO: Jericoacoara para Fortaleza\nProcesso: Este é um traslado direto de Jericoacoara para Fortaleza.\nHorário de saída: 16:30h.\nValor (só volta): R$ 130,00 por pessoa.\n\nInformações Gerais\nO que está incluído (no geral):\nTransporte ida e volta em ônibus, micro-ônibus ou vans.\nGuia turístico.\nO que não está incluído:\nPasseios opcionais não mencionados.\nAlimentação.\nQualquer outro item não citado na oferta.\nLocais e Horários de Embarque (para a Ida):\nLocais: Mercado Central e hotéis na Praia de Iracema, Praia do Meireles, Praia do Mucuripe e Praia do Futuro.\nHorários:\nPraia do Futuro: 03:00h\nAvenida Beira Mar: 03:15h\nPraia de Iracema: 03:30h (O último embarque ocorre às 03:45h).\nCancelamento: Consulte nossos termos e condições.\n\nFaça sua reserva\nDuração (viagem de ida com passeio): Aproximadamente 15:00h\nCapacidade: 50 pessoas\nValor: R$ 130 por adulto (por trecho)\nInformações para reserva:\nQuantidade de Adultos\nQuantidade de Crianças\nEscolha uma data\nLocal de Embarque\n\n\n\n\n\n\n\n**Privativo de 4×4 para Jericoacoara saindo de Fortaleza**\n* **Descrição:** Confira nossa disponibilidade e agende a data e o horário que forem melhores para você.\n\n* **Capacidade:** 4 pessoas\n* **Valor:** R$800\n\nTraslado Privativo de 4x4 para Jericoacoara (saída de Fortaleza)\nInformações e Itinerário\nO transfer privativo para Jericoacoara acontece todos os dias da semana, inclusive nos feriados. Conforme o horário previamente marcado, seu embarque será realizado em qualquer ponto da Orla de Fortaleza ou no Aeroporto.\nO veículo 4x4 segue até o município de Paraipaba (a 100 km de Fortaleza) para uma rápida parada de aproximadamente 15 minutos. A segunda parada é em Jijoca de Jericoacoara, de onde a viagem dura em média mais 40 minutos até o destino final, o paraíso de Jericoacoara.\n\nValores do Veículo Privativo:\nAté 4 pessoas: R$ 800,00\nAté 5 pessoas: R$ 900,00\nAté 6 pessoas: R$ 1.000,00\n(Observação: os valores não são válidos para o período de 20/12 a 06/01. É necessário consultar via WhatsApp para essas datas).\n\nO que está incluído:\nTransfer de Fortaleza para Jericoacoara.\nVeículo 4x4 para acesso a Jericoacoara.\nEmbarque e desembarque no seu hotel ou no Aeroporto.\nO que não está incluído:\nTaxa de turismo sustentável de Jericoacoara (R$ 41,50 por pessoa, válida por 7 dias).\nAlimentação.\nQualquer outro item não citado na oferta.\n\nInformações Gerais:\nDuração da Viagem: Aproximadamente 5 horas.\nHorário do Embarque: O horário exato pode variar em torno de 25-30 minutos em relação ao horário escolhido para o traslado.\n\n\n\n---\n\n\n\n### **Depoimentos**\n\n* **Natalia Cardona (Julho, 2022):** \"Muito boa, divertida!\"\n* **Rose Abreu (Junho, 2022):** \"Passeios maravilhosos, Guia super atenciosa, guias locais muito receptivos. Transporte seguro. Super indico. Guia Veridiana nota 1000, atenciosa, cuidadosa e simpática.\"\n* **Anderson Fernandes (Junho, 2022):** \"Top de mais os passeios no Ceará.\"\n* **Valdo Júnior (Junho, 2022):** \"Foi uma experiência que jamais vamos esquecer, dias de muitas realizações,..nossos agradecimentos a Deus, e a todos que nos ajudaram a viver tudo isso... obrigado a todos os envolvidos COCO VERDE TURISMO.\"\n* **Juliana Sebim (Junho, 2022):** \"Excelente passeio, lugar lindo de mais, vale a pena! Nosso guia foi o Junior Dantas, que aliás foi um excelente guia, muito animado, divertido, disposto, nos orientou, e auxiliou em tudo! Show de bola! Recomendamos para todos!\"\n* **Celia Pietrobon Costanaro (Junho, 2022):** \"Passeio maravilhoso! Recomendo.\"\n* **Viviane Cavalcante Serpa (Junho, 2022):** \"Ficamos muito satisfeitos pelo serviço prestado pela coco verde, todos os guias muito educados e atenciosos com nossa segurança e necessidades. Ônibus limpo. Pontualidade. O guia Roque está de parabéns pela ótima explicação, muito detalhista com a história da cidade. excelente! Obrigada.\"\n* **Meyer Abecassis (Maio, 2022):** \"De fato o guia faz toda a diferença num passeio, quero aqui parabenizar o Júnior Dantas pela sua recepção, cuidado e acompanhou do início até o fim. Obrigado Coco verde por realizar sonhos. Fica a minha gratidão a agência e Júnior Dantas. Gratidão.\"\n\n---\n\n### Perguntas para conduzir cliente no funil vendas!\n\n1-Para qual data você gostarai de fazer seus passeios ou traslados ?\n2- você estará hospedada(o) em qual cidade ?\n\n\n### Perguntas clientes fazem \n\nCliente clicou anuncio pacote com hospedsgem para Jericoacoara saindo de Fortaleza. 2 dias 1 noite ou 3 dias 2 noite.\nCliente :pretendo ir pra Jeri e ficar uns 4 dias!\nConsultor:  qual data ida e volta você gostaria de ir para Jericoacoara? são quantas pessoas ?\nCliente:  não sei ainda queria mais detalhes.\nConsultor: para saber mais detalhes primeiro preciso saber data ida e volta para verificar disponibilidade e opções pousadas e quantidade de pessoas.\nOBs : cliente informar data ida e volta , ai damos sequencia ao atendimento. Com as opções pousadas, horário saída e horário retorno.\n\nCliente : Quero ir em Jericoacoara e passeio de buggy pra canoa quebrada.\nConsultor: Temos 2 opçoes Jericoacoara bate volta no mesmo dia :\n1-\tEconomy\n2-\tJeri bv vip\n3-\tTemos opção passar 1 noite ou 2 noite.\nQual diferença economy para vip ?\nConsultor :Vip tem entrada incluso 3 beach club Buraco azul Lagun beach Alquimist beach club. \n\nEconomy não tem entrada incluso só vai Buraco azul 30,00 Lagun Beach 30,00 entrada e carauba beach lagoa do paraíso entrada incluso.\nCliente: qual mais procurado vip ou economy ? \nConsultor: vip mais completo.\nCliente: quanto é pacote 2 dias 1 noite ou 3 dias 2 noite?\nConsultor: qual data ida e volta você gostaria de ir para Jericoacoara.?\nCliente:  25 a 27/10 2 pessoas.\nConsultor: obrigado pelas informações vou verificar disponibilidade e valores ok.\n\nCliente: ola gostaria de saber qual valor traslado ou qual valor para ir para Jericoacoara:\nConsultor: para qual data você gostaria de ir para Jericoacoara ?\nConsultor : você estará em qual cidade ?\nCliente 1: Fortaleza , 23 a 2/10\nConsultor:  envia as opções traslado ida e volta para Jericoacoara saindo de Fortaleza.(lembrando que traslado ida e volta em dias diferentes não e passeio bate volta no mesmo dia ).\n\nCliente 2: vou desembarcar ou vou descer em Jericoacoara.\nConsultor: traslado aeroporto JJd x vila Jericoacoara R$80,00 por pessoa compartilhado hylux sw4 ou privativo ate 4 pessoas 320,00 ate 5 pessoas 360,00 ate 6 pessoas 400,00.\n\nCliente :Preciso traslado aeroporto para Jericoacoara 2 pessoas ou 6 pessoas\nConsultor: qual aeroporto de Fortaleza ou aeroporto Jericoacoara ?\nCliente 1: fortaleza meu voo chega 12h \nConsultor : temos opção privativo 4x4 800,00 ida ate 4 pessoas 1000,00 ate 6 pessoas, 2 pessoas também temos compartilhado 4x4 250,00 por pessoa pode ir ate 6 pessoas nesse formato ok horário são combinar entre 10h as 17h compartilhado já privativo saída qualquer horário.\n\n\n---\n\n### **Informações**\n\n* **Funcionamento:** Todos os dias de 06:00 às 22:00.\n\n* **Endereço:** Rua 11, Nº 40 - Barra do Ceará, Fortaleza-CE, CEP 60330-792.\n\n* **Passeios Populares:** Jericoacoara em 1 Dia, 3 Praias em 1 dia, Beach Park, Praia de Cumbuco, Praia de Lagoinha, Canoa Quebrada Direto.\n\n* **Pacotes Populares:** 3 dias em Jericoacoara com Piscina, 2 dias em Jericoacoara com Piscina, 3 dias em Jericoacoara sem Piscina, 2 dias em Jericoacoara sem Piscina.\n\n\n---\n© Coco Verde Turismo CNPJ 17.720.976/0001-31 \n\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,1120],"id":"9eff9e88-a751-4ba9-96d3-6aa682a5e226","name":"Edit Fields12"},{"parameters":{"promptType":"define","text":"=contex todo cliente: {{ $item(\"0\").$node[\"Switch das funçoes\"].json[\"arguments\"][\"query\"] }}\ntipo de informação: {{ $item(\"0\").$node[\"Switch das funçoes\"].json[\"arguments\"][\"tipo_informacao\"] }} \ncontexto cliente: {{ $item(\"0\").$node[\"Switch das funçoes\"].json[\"arguments\"][\"contexto_cliente\"] }}\n\nDados estruturados do site:\n{{ $item(\"0\").$node[\"Edit Fields12\"].json[\"dados RAG:\"] }}\n\n","options":{"systemMessage":"=Prompt Otimizado: Gerador de Relatórios de Dados (RAG Tool)\nAtue como um Robô de Extração e Geração de Relatórios. Sua única tarefa é analisar uma consulta, localizar todas as informações relevantes em uma base de conhecimento, e retornar um relatório de texto, claro, objetivo e factual.\n\n# DIRETRIZES FUNDAMENTAIS\n\nNÃO SEJA CONVERSACIONAL. Não use saudações, frases de marketing, emojis ou perguntas.\nAPENAS LISTE OS FATOS. Seu trabalho é apresentar os dados brutos de forma organizada e legível para outra IA.\nESTRUTURE A INFORMAÇÃO. Use um formato de Chave: Valor para cada dado e separe os diferentes resultados encontrados de forma clara.\nNÃO RESUMA OU INTERPRETE. Apenas transcreva os dados relevantes.\n# CONTEXTO E DADOS DE ENTRADA\n\nVocê receberá os seguintes dados:\n\ncontexto_cliente: Um texto descrevendo a pergunta a ser pesquisada.\ndados_RAG: Um objeto JSON grande contendo toda a base de conhecimento.\n# OBJETIVO PRINCIPAL\n\nAnalisar a consulta no contexto_cliente, realizar uma busca exaustiva nos dados_RAG e retornar um bloco de texto simples contendo todos os dados correspondentes, formatados como um relatório. Se nada for encontrado, retorne o texto \"Nenhum dado encontrado.\".\n\n# FLUXO DE RACIOCÍNIO (Chain of Thought)\n\nAnalisar a Consulta: Identifique as palavras-chave principais na consulta do cliente.\nBuscar e Coletar: Encontre TODOS os itens nos dados_RAG que correspondam às palavras-chave. Uma consulta pode ter múltiplos resultados.\nEstruturar e Escrever o Relatório: Para cada item encontrado, crie um bloco de texto seguindo o formato Chave: Valor. Separe cada item com um divisor claro.\n# FORMATO DE SAÍDA OBRIGATÓRIO (TEXTO)\nUse a seguinte estrutura para sua resposta.\n\nSe encontrar resultados:\n\n--- DADOS ENCONTRADOS ---\n\n--- ITEM 1 ---\nNome: [Nome do passeio ou pacote]\nTipo: [Tipo de recurso, ex: passeio, pacote]\nValor: [Preço do item]\nDuração: [Duração do passeio]\nIncluso: [Lista do que está incluso]\nNotas Adicionais: [Qualquer outra informação relevante]\n\n--- ITEM 2 ---\nNome: [Nome do segundo passeio]\nTipo: [Tipo de recurso]\n... e assim por diante\nSe não encontrar resultados:\n\nNenhum dado encontrado.\n# EXEMPLOS DE EXECUÇÃO\nExemplo 1: Consulta sobre Jericoacoara\nInput (contexto_cliente): \"Quero saber sobre o passeio para Jericoacoara\"\nOutput ESPERADO (Apenas o texto direto):\n--- DADOS ENCONTRADOS ---\n\n--- ITEM 1 ---\nNome: Jericoacoara Bate e Volta\nTipo: passeio\nValor: R$ 230\nDuração: 18 horas\nDias de Operação: Quarta, Quinta, Terça\nIncluso: Transporte, guia turístico credenciado\n\n--- ITEM 2 ---\nNome: Passeio de Buggy Lado Oeste (Jeri)\nTipo: passeio\nValor: R$ 500\nNotas Adicionais: Valor para até 4 pessoas\nDuração: 18 horas\nIncluso: Transporte, guia especializado\n\n--- ITEM 3 ---\nNome: Pacote de 2 Dias e 1 Noite (Jeri)\nTipo: pacote\nValor: R$ 1.250 (com piscina) ou R$ 750 (sem piscina)\nIncluso: Traslado, guia turístico, hospedagem com café da manhã\nAtividades Opcionais: Passeios de buggy\nExemplo 2: Consulta Específica de Preço\nInput (contexto_cliente): \"quanto custa 3 praias?\"\nOutput ESPERADO (Apenas o texto direto):\n--- DADOS ENCONTRADOS ---\n\n--- ITEM 1 ---\nNome: 3 Praias em 1 dia\nTipo: passeio\nSinônimos: Morro Branco, Praia das Fontes, Canoa Quebrada\nValor: R$ 80\nIncluso: Transporte ida e volta, acompanhamento de guia\n# INSTRUÇÃO FINAL\nSua resposta final deve ser exclusivamente o bloco de texto formatado como um relatório. Não inclua nenhuma frase introdutória ou de encerramento. Comece diretamente com --- DADOS ENCONTRADOS --- ou Nenhum dado encontrado.."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[672,1120],"id":"c996b093-cc46-46b9-bf3d-b20815534864","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[656,1280],"id":"2f9ab8b7-2510-492c-aecc-0499bce8959f","name":"OpenAI Chat Model"},{"parameters":{"assignments":{"assignments":[{"id":"c8c7f85d-06fb-4a38-b508-312941aaf852","name":"dados","value":"=nome: {{ $json.name }}\nemail: {{ $json.skype }}\ntelefone: {{ $json.phones[0].phone }}\nativa: {{ $item(\"0\").$node[\"busca negocio\"].json[\"organization\"][\"name\"] }}\ncriado: {{ $item(\"0\").$node[\"busca negocio\"].json[\"created_at\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-7872,1968],"id":"d9002e3f-011d-4986-9e75-b601c5642a31","name":"qual tag1","alwaysOutputData":true},{"parameters":{"url":"https://crm.rdstation.com/api/v1/contacts","sendQuery":true,"queryParameters":{"parameters":[{"name":"phone","value":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"numero\"] }}"},{"name":"token","value":"65cf63a700a768000df641b6"},{"name":"page","value":"1"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8304,2064],"id":"ba972a6c-235c-46d1-b187-da42b61d1202","name":"busca contato4","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fc0cdeff-fc3f-449b-946a-5b7700e95e3e","leftValue":"={{ $item(\"0\").$node[\"busca negocio\"].json[\"organization\"][\"name\"] }}","rightValue":"automação AI","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7712,1968],"id":"09b38108-3898-461a-b355-f31f794da47e","name":"If2"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-7536,2016],"id":"ba9d9a26-505a-4757-9f6c-03ac46952990","name":"No Operation, do nothing3"},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/chat/findMessages/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"where\": {\n    \"key\": {\n      \"remoteJid\": \"{{ $item(0).$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"chat_id\"] }}\"\n    }\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8016,2144],"id":"352963f8-07e8-4b5b-a84f-8b9d10a97ae2","name":"BUSCA CONVERSA"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5839e7a5-5c7f-4479-843b-75aa39730b08","leftValue":"={{ $json.total }}","rightValue":0,"operator":{"type":"number","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8176,2064],"id":"7595aabb-ee7d-4342-856f-c8caef6bf13e","name":"If3"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ba98ce41-3e30-4d9b-ade2-eae5ec7fe632","leftValue":"={{ $item(\"0\").$node[\"BUSCA CONVERSA\"].json[\"messages\"][\"total\"] }}","rightValue":4,"operator":{"type":"number","operation":"lte"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7792,2144],"id":"6e48047f-7eb7-4655-90a5-9f3dc17a4af1","name":"If4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-7536,2208],"id":"58825c81-42b7-4794-967a-04497c173c6b","name":"No Operation, do nothing4"},{"parameters":{"method":"PUT","url":"=https://crm.rdstation.com/api/v1/deals/{{ $item(\"0\").$node[\"busca contato4\"].json[\"contacts\"][\"0\"][\"deals\"][\"0\"][\"id\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"deal\": {\n    \"prediction_date\": \"{{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"data_viagem\"] }}{{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"data_viagem_pretendida\"] }}\",\n    \"name\": \"{{ $item(\"0\").$node[\"busca negocio\"].json[\"name\"] }} {{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"data_viagem\"] }}{{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"data_viagem_pretendida\"] }}\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-272,560],"id":"4df20bbb-f28e-48f4-96e5-f330fc034091","name":"atualiza crm"},{"parameters":{"assignments":{"assignments":[{"id":"792fc39d-2783-4678-a67f-9f617c1374ce","name":"dados RAG:","value":"=Galeria de Imagens\n\nImagens de Jericoacoara\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/Jeri-landing-05-qt6t39hg6nwjudexiaa8ggmc88ocfu2ubyb0rxuft4.jpeg\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/Jeri-landing-04-qt6t39hg6nwjudexiaa8ggmc88ocfu2ubyb0rxuft4.jpeg\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/Jeri-img-2022145-1-qt6t39hg6nwjudexiaa8ggmc88ocfu2ubyb0rxuft4.jpg\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/Jeri-landing-10-qt6t39hg6nwjudexiaa8ggmc88ocfu2ubyb0rxuft4.jpeg\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/Jeri-landing-09-e1682614001848-qt6t3afadhxu5zdkcsov0ydstmjpnj6ko2yi97t1mw.jpeg\n\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/Jericoacoara-LIST-04-1-qt6t39hm9xupwe7lkum30uu5exqhqm5fqx8viy8jyo.jpg\n\n\nImagens de Canoa Quebrada\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/Praia-Canoa-Quebrada-1-r5dkq0d9hoyeqc3j98owhg11dkyg7ed7g8ebrlkrd4.jpeg\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/2022/05/CanoaDireto-LIST-02.jpg\n\nImagens de Cumbuco\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/BuggyCumbuco-LIST-02-qt6t39hg6nwjudexiaa8ggmc88ocfu2ubyb0rxuft4.jpg\n\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/cumbuco-LIST-04-qt6t39hm9xupwe7lkum30uu5exqhqm5fqx8viy8jyo.jpg\n\n\nImagens Gerais e Institucionais (Logos, WhatsApp, etc.)\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/WhatsApp-Image-2024-04-26-at-10.39.19-2-qt6t3afadhxu5zdkcsov0ydstmjpnj6ko2yi97t1mw.jpeg\n\nhttps://cocoverdeturismo.com.br/wp-content/uploads/elementor/thumbs/WhatsApp-Image-2024-04-26-at-10.39.18-qt6t3afadhxu5zdkcsov0ydstmjpnj6ko2yi97t1mw.jpeg\n\nDocumentos de Passeios e Pacotes (PDFs)\nJericoacoara\nPacote 3 dias: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Pacote%20de%20viagem%203%20dias%20e%202%20noites%20em%20jericoacoara.pdf\nBate e volta VIP: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Jericoacoara%20bate%20e%20volta%20em%20um%20dia%20VIP.pdf\nBate e volta Economy: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Jericoacoara%20bate%20e%20volta%20em%20um%20dia%20Economy.pdf\nOutras Praias\nCanoa Quebrada: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Descubra%20Canoa%20Quebrada%20O%20Refugio%20Encantado.pdf\nParacuru: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Praia%20Paracuru.pdf\nLagoinha: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Lagoinha.pdf\nFlecheiras: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Flecheiras.pdf\nCumbuco: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Cumbuco.pdf\nÁguas Belas: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/aguas%20Belas.pdf\n3 Praias em 1 dia: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/3%20Praias%20em%20um%20dia%20com%20passeio%20Buggy%20Incluso.pdf\nRecursos de Prova Social\nVídeos\nGuia Canoa Quebrada: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe//adriano-colaborador.mp4\nQualidade do Ônibus: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe//onibus2.mp4\nDepoimento 3 Praias: https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe//casal3praias.mp4\n\nMateriais de Interação para Leads\nDicas Fortaleza à Noite (Documento): https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/filipe/doc/Dicas%20o%20que%20fazer%20em%20Fortaleza%20a%20noite_compressed.pdf","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,1280],"id":"d85bd02e-c86b-4e33-bb94-e7d18140e4ba","name":"Edit Fields13"},{"parameters":{"promptType":"define","text":"=Consulta do cliente: {{ $('Switch das funçoes').item.json.arguments.contexto_envio }}\nmaterial: {{ $('Switch das funçoes').item.json.arguments.tipo_material }}\ndestino: {{ $('Switch das funçoes').item.json.arguments.destino }}\ndestino especifico: {{ $('Switch das funçoes').item.json.arguments.material_especifico }}\n\nDados:\n{{ $json[\"dados RAG:\"] }}\n","options":{"systemMessage":"=Atue como um Agente de Análise de Contexto e Recuperação de Dados. Você é um componente especializado dentro de um fluxo de automação. Sua função é receber um bloco de texto pré-formatado, dissecar suas partes, e executar uma busca de alta precisão para encontrar um recurso dentro dos dados fornecidos.\n\n# CENÁRIO E ESTRUTURA DO INPUT\nVocê receberá um único input de texto, que sempre seguirá a estrutura abaixo. As informações são separadas por linhas em branco.\n\nPlaintext\n\nConsulta do cliente: '' texto da pergunta original do usuário ''\n\nmaterial: '' tipo de material buscado, se houver ''\ndestino: '' destino principal, se houver ''\ndestino especifico: '' destino mais detalhado, se houver ''\n\nDados:\n'' um objeto JSON completo contendo a base de conhecimento, referido como \"dados RAG\" ''\n\n# TAREFA PRINCIPAL\nSua tarefa é analisar o Consulta do cliente, usar os campos material, destino e destino especifico como contexto adicional, e pesquisar na base de conhecimento fornecida no campo Dados para encontrar o único recurso mais relevante. A resposta deve ser um único objeto JSON.\n\n# FLUXO DE RACIOCÍNIO (Chain of Thought)\n\nSiga estes passos com extrema precisão:\n\n1. Parse e Desconstrução do Input:\n* Leia o bloco de texto inteiro.\n* Isole o conteúdo de cada linha:\n* query_cliente = o texto após \"Consulta do cliente:\".\n* contexto_material = o texto após \"material:\".\n* contexto_destino = o texto após \"destino:\".\n* contexto_destino_especifico = o texto após \"destino especifico:\".\n* string_json_dados = todo o texto que começa em \"{\" após a linha \"Dados:\".\n* Trate a string_json_dados como a sua knowledgeBase (Base de Conhecimento) para a busca.\n\n2. Análise da Consulta e Extração de Palavras-Chave:\n* A partir da query_cliente, extraia as palavras-chave principais e o tipo de recurso desejado (\"vídeo\", \"pdf\", etc.), como definido no nosso prompt anterior.\n\n3. Busca e Pontuação Unificada (com Contexto):\n* Inicie o processo de busca iterando por cada item da knowledgeBase (extraída dos Dados).\n* Para cada item, calcule a pontuação usando as regras de pontuação que definimos anteriormente (pontos por match em título, URL, etc., e bônus por tipo de recurso).\n* Adicione a seguinte regra de BÔNUS DE CONTEXTO:\n* Se o campo category ou tipo de um recurso corresponder (mesmo que parcialmente) ao texto em contexto_destino ou contexto_destino_especifico, adicione um bônus crucial de +25 pontos. Isso garante que o contexto do fluxo refine a busca.\n\n4. Seleção e Formatação da Saída:\n* Identifique o recurso com a maior pontuação total.\n* Construa o objeto JSON de saída usando o formato universal que definimos.\n\n# REGRAS E FORMATO DE SAÍDA UNIVERSAL\n\nA sua resposta final DEVE SER APENAS O CÓDIGO JSON, sem explicações adicionais.\nSe um recurso relevante for encontrado, a saída DEVE seguir este formato:\nJSON\n\n{\n  \"relevance_score\": 115,\n  \"resource_type\": \"documento\",\n  \"title\": \"Pacote 3 dias\",\n  \"url\": \"https://.../Pacote%20de%20viagem%203%20dias.pdf\",\n  \"category\": \"jericoacoara\"\n}\nSe nenhuma correspondência for encontrada, retorne:\nJSON\n\n{\n  \"relevance_score\": 0,\n  \"resource_type\": null,\n  \"title\": null,\n  \"url\": null,\n  \"category\": null\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[656,1280],"id":"e6c9932a-d2df-40e6-828e-0b0436560c83","name":"AI Agent1"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[576,1216],"id":"b2bd4b95-8c05-44ac-b8a9-e62470402294","name":"OpenAI Chat Model1"},{"parameters":{"assignments":{"assignments":[{"id":"47793952-0e88-48a6-9c4f-09c6323d2079","name":"output","value":"={{ $json.output }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1024,1200],"id":"fdbd52c8-96aa-4151-8d33-883c608fe90f","name":"Edit Fields14"},{"parameters":{"url":"=https://crm.rdstation.com/api/v1/contacts/{{ $item(\"0\").$node[\"busca contato4\"].json[\"contacts\"][\"0\"][\"id\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"},{"name":"page","value":"1"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8016,1968],"id":"c27eeb87-e794-4979-84b1-1481fb0d9d80","name":"busca negocio"},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"etapa","fieldValue":"reserva"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[256,304],"id":"87d6d2a3-0c3b-40c9-96d2-c77d73273141","name":"Supabase10","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"etapa","fieldValue":"proposta"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[256,160],"id":"5c527524-174b-4e56-b655-063d1b9d473f","name":"Supabase11","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"etapa","fieldValue":"objeçoes"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[256,16],"id":"8d382c4c-57c3-426f-804f-14a2a55e7283","name":"Supabase12","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[176,768],"id":"49c61f63-a776-41d4-93b9-41cd4e20aaf9","name":"No Operation, do nothing5"},{"parameters":{"method":"POST","url":"=https://evo1.oferta24h.site/message/sendWhatsAppAudio/lucasprincipal","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"=F395C136DB68-45B2-BD6D-9D5984545694"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"=120363419500400037@g.us"},{"name":"audio","value":"=https://hjsjnkwuyrcpkggdkypp.supabase.co/storage/v1/object/public/jean//limpar%20no%20serasa.ogg"}]},"options":{"redirect":{"redirect":{}}}},"id":"f31244f9-85a3-48f2-abfb-f6abf48bb451","name":"envia audio4","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1232,1824]},{"parameters":{"language":"python","pythonCode":"import json\nfrom bs4 import BeautifulSoup\n\n# Lista que será retornada no final\nresults = []\n\n# O n8n passa a entrada na variável 'items'\nfor item in items:\n    html_content = item['json']['data']\n    soup = BeautifulSoup(html_content, 'html.parser')\n    \n    passeios_extraidos = []\n\n    # --- 1. Extrair Passeios dos Links do Rodapé ---\n    # Este seletor busca pela seção específica \"Passeios\" no rodapé da página\n    passeios_widget = soup.select_one('.elementor-element-2c51f9a')\n\n    if passeios_widget:\n        # Encontra todos os links dentro dessa seção\n        links_passeios = passeios_widget.select('a')\n\n        for link in links_passeios:\n            # Pega o texto do link (nome do passeio) e o URL\n            nome_passeio = link.get_text(strip=True)\n            url_passeio = link.get('href')\n\n            # Adiciona à lista se encontrou nome e URL\n            if nome_passeio and url_passeio:\n                passeios_extraidos.append({\n                    'nome_passeio': nome_passeio,\n                    'url': url_passeio\n                })\n    \n    # --- 2. Extrair Dados Gerais da Empresa (do JSON-LD) ---\n    empresa_info = {}\n    script_tag = soup.find('script', {'type': 'application/ld+json'})\n    if script_tag and script_tag.string:\n        try:\n            structured_data = json.loads(script_tag.string)\n            # Procura pelo objeto do tipo \"Organization\" no JSON\n            for graph_item in structured_data.get('@graph', []):\n                if graph_item.get('@type') == 'Organization':\n                    empresa_info = {\n                        'nome_empresa': graph_item.get('name'),\n                        'url_principal': graph_item.get('url'),\n                        'email': graph_item.get('email'),\n                        'telefone': graph_item.get('contactPoint', [{}])[0].get('telephone'),\n                        'endereco': graph_item.get('address', {}).get('streetAddress')\n                    }\n                    break \n        except (json.JSONDecodeError, AttributeError):\n            empresa_info = {\"erro\": \"Falha ao processar dados da empresa do JSON-LD.\"}\n\n\n    # --- 3. Preparar a Saída Final ---\n    # Monta o objeto JSON final com os dados extraídos\n    final_data = {\n        'empresa': empresa_info,\n        'aviso': 'A lista de passeios com preços não está presente no HTML inicial. Os dados abaixo foram extraídos dos links encontrados na página.',\n        'passeios_encontrados': passeios_extraidos\n    }\n    \n    results.append({'json': final_data})\n\n# Retorna o resultado para o n8n\nreturn results"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1328,-160],"id":"442cc9e9-8cf2-4447-af4a-f97e9b6f2145","name":"Code2"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-2368,-240],"id":"32feae44-e77e-4b55-9ba9-8dec4d00f3f5","name":"When clicking ‘Test workflow’"},{"parameters":{"assignments":{"assignments":[{"id":"18257aa0-fc9b-4c13-a6ee-d59d0e157ea8","name":"organizado","value":"={{ $json.organizado }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-944,-368],"id":"fbdc531f-ff6c-42d7-bd48-41235c6bb390","name":"Edit Fields16"},{"parameters":{"url":"https://cocoverdeturismo.com.br/passeios/","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2064,-288],"id":"d312d116-3e48-4933-9101-25df90576dab","name":"HTTP Request5"},{"parameters":{"method":"POST","url":"https://crm.rdstation.com/api/v1/activities","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"activity\": {\n    \"deal_id\": \"{{ $item(\"0\").$node[\"busca negocio\"].json[\"deal_ids\"][\"0\"] }}\",\n    \"user_id\": \"{{ $item(\"0\").$node[\"Switch das funçoes\"].json[\"arguments\"][\"observacoes\"] }}\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-128,560],"id":"e1ae48cf-fe31-4ead-8ccd-0ed3c0ddf17d","name":"atualiza crm2","disabled":true},{"parameters":{"url":"https://crm.rdstation.com/api/v1/contacts","sendQuery":true,"queryParameters":{"parameters":[{"name":"phone","value":"={{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"numero\"] }}"},{"name":"token","value":"65cf63a700a768000df641b6"},{"name":"page","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"api-token","value":"U2FsdGVkX18l0P9AMegoDYWWfaKpsds+BaA5FN8YJYY1LC0tJsywD0cjMPOmQKNU2CUUNB8aIxPQSJODPEPaiA=="}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-416,400],"id":"ee61c0ed-bf9a-4fe0-bedb-5aa85033c45e","name":"lista contato1"},{"parameters":{"url":"=https://crm.rdstation.com/api/v1/contacts/{{ $item(\"0\").$node[\"lista contato1\"].json[\"contacts\"][\"0\"][\"id\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65d352301393f2001e30441c"},{"name":"page","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-272,400],"id":"fea32a6a-e87b-4e1d-b625-63b7ca647b4e","name":"id do contato3"},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"humano ou IA\"].json[\"thread_id\"] }}/messages","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"},{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"role","value":"assistant"},{"name":"content","value":"={{ $item(\"0\").$node[\"Variáveis\"].json[\"mensagem\"] }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3472,1264],"id":"8ab3c6ae-3c3c-428e-a76e-efcb9ccb0a42","name":"HTTP Request3","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}},"onError":"continueErrorOutput"},{"parameters":{"operation":"getAll","tableId":"FILIPE","returnAll":true,"filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-3808,1328],"id":"39ca266d-9e02-4d20-8503-a9fec8aa7cc9","name":"busca thread","credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1afd4588-dd3b-444a-b477-3022707879f2","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"fromMe\"] }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3664,1328],"id":"227dc6af-dbf3-4a33-9e30-65af7598b38c","name":"humano ou IA"},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"humano ou IA\"].json[\"thread_id\"] }}/messages","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"},{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"role","value":"user"},{"name":"content","value":"={{ $item(\"0\").$node[\"Variáveis\"].json[\"mensagem\"] }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3472,1408],"id":"7ac5e12e-e619-4f65-ba15-3e980c7767e7","name":"HTTP Request6","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}},"onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://crm.rdstation.com/api/v1/deals/{{ $item(\"0\").$node[\"busca contato4\"].json[\"contacts\"][\"0\"][\"deals\"][\"0\"][\"id\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"deal\": {\n    \"organization_id\": \"65d352301393f2001e30441c\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4144,1440],"id":"32a30bbb-46e1-45b6-a1c7-70001b41454a","name":"humano","onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://crm.rdstation.com/api/v1/deals/{{ $item(\"0\").$node[\"busca contato4\"].json[\"contacts\"][\"0\"][\"deals\"][\"0\"][\"id\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"deal\": {\n    \"organization_id\": \"65d352301393f2001e30441c\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[32,768],"id":"39e569ef-cba8-45c6-ab83-e292e1ded5bd","name":"humano1"},{"parameters":{"jsCode":"// Código n8n - Function Node SIMPLIFICADO\n// Gera APENAS a mensagem formatada nos 3 modelos exatos\n\nconst dados = $input.first().json;\nconst argumentos = dados.arguments;\n\n// Extrair apenas dados necessários para a mensagem\nconst clienteNome = argumentos.cliente_nome || 'Cliente';\nconst localizacaoCliente = argumentos.localizacao_cliente || '';\nconst dataViagem = argumentos.data_viagem || '';\nconst numerosPessoas = argumentos.numero_pessoas || '';\nconst tipoInteresse = argumentos.tipo_interesse || '';\nconst servicoEspecifico = argumentos.servico_especifico || '';\nconst valorTotal = argumentos.valor_total || '';\nconst hotelEndereco = argumentos.hotel_endereco || '';\nconst horarioChegadaVoo = argumentos.horario_chegada_voo || '';\nconst observacoesEspeciais = argumentos.observacoes_especiais || '';\n\n// Determinar local de embarque\nlet hotelPickup = '';\nif (servicoEspecifico.includes('Aeroporto_Jeri_para_Vila')) {\n  hotelPickup = 'Aeroporto Jericoacoara';\n} else if (servicoEspecifico.includes('Aeroporto_Fortaleza')) {\n  hotelPickup = 'Aeroporto Fortaleza';\n} else {\n  hotelPickup = hotelEndereco || localizacaoCliente || 'Local a definir';\n}\n\n// Mapear destino baseado no serviço\nlet destino = '';\nif (servicoEspecifico.includes('Jeri')) destino = 'Jericoacoara';\nelse if (servicoEspecifico.includes('Canoa')) destino = 'Canoa Quebrada';\nelse if (servicoEspecifico.includes('Cumbuco')) destino = 'Cumbuco';\nelse if (servicoEspecifico.includes('3_Praias')) destino = '3 Praias';\nelse destino = 'Destino';\n\nlet mensagemFinal = '';\nlet tipoMensagem = '';\n\n// MODELO 1: Grupo Buggy - Formato simples\nif (servicoEspecifico.includes('Buggy') || \n    servicoEspecifico === '3_Praias_com_Buggy' ||\n    servicoEspecifico === 'Paracuru_com_buggy_incluso' ||\n    observacoesEspeciais.toLowerCase().includes('buggy') ||\n    observacoesEspeciais.toLowerCase().includes('buggies') ||\n    numerosPessoas > 3) {\n  \n  tipoMensagem = 'grupo_buggy';\n  const [dia, mes] = dataViagem.split('/');\n  \n  mensagemFinal = `${numerosPessoas} praias com Buggy\n${dia}/${mes}\nEmbarque ${hotelPickup}\n\n${clienteNome}\n\nTotal ${valorTotal}`;\n\n}\n// MODELO 2: Pacote Pousada - Com pergunta \"Embarque?\"\nelse if (tipoInteresse === 'pacote_hospedagem' ||\n         servicoEspecifico.includes('pacote') ||\n         observacoesEspeciais.toLowerCase().includes('pousada') ||\n         observacoesEspeciais.toLowerCase().includes('hospedagem')) {\n  \n  tipoMensagem = 'pousada_consulta';\n  const [dia, mes] = dataViagem.split('/');\n  const diasPacote = servicoEspecifico.includes('3D2N') ? 3 : 2;\n  const dataFim = parseInt(dia) + diasPacote - 1;\n  const dataFormatada = `${dia} a ${dataFim}/${mes}`;\n  \n  mensagemFinal = `Pacote pousada ${destino} ${dataFormatada} + lado leste\nEmbarque?\n\n${clienteNome}\n\nTotal ${valorTotal}`;\n\n}\n// MODELO 3: Transfer/Traslado - Com informações de transfer\nelse if (tipoInteresse === 'traslado_transfer' ||\n         servicoEspecifico.includes('Traslado') ||\n         servicoEspecifico.includes('Aeroporto') ||\n         observacoesEspeciais.toLowerCase().includes('transfer') ||\n         observacoesEspeciais.toLowerCase().includes('traslado')) {\n  \n  tipoMensagem = 'transfer_ida';\n  let tipoTransfer = '';\n  let destinoTransfer = '';\n  \n  if (servicoEspecifico.includes('Aeroporto_Fortaleza_para_Jeri')) {\n    tipoTransfer = 'Transfer ida Fortaleza';\n    destinoTransfer = 'Jericoacoara';\n  } else if (servicoEspecifico.includes('Aeroporto_Jeri_para_Vila')) {\n    tipoTransfer = 'Transfer aeroporto Jericoacoara';\n    destinoTransfer = 'vila';\n  } else {\n    tipoTransfer = 'Transfer ida';\n    destinoTransfer = destino;\n  }\n  \n  const infoVoo = horarioChegadaVoo ? ` - voo ${horarioChegadaVoo}` : '';\n  \n  mensagemFinal = `${tipoTransfer} x ${destinoTransfer} + lado leste ${dataViagem}${infoVoo}\nEmbarque\nvia ${hotelPickup}\n\n${clienteNome}\n\nTotal ${valorTotal}`;\n\n}\n// MODELO 4: Passeio Padrão\nelse {\n  tipoMensagem = 'passeio_padrao';\n  \n  mensagemFinal = `${servicoEspecifico.replace(/_/g, ' ')} ${destino}\n${dataViagem}\nEmbarque ${hotelPickup}\n\n${clienteNome}\n\nTotal ${valorTotal}`;\n}\n\n// Adicionar observações especiais se houver informações importantes\nif (observacoesEspeciais && observacoesEspeciais.trim()) {\n  mensagemFinal += `\\n\\n${observacoesEspeciais}`;\n}\n\n// Retornar APENAS a mensagem formatada\nreturn [{\n  json: {\n    mensagem_whatsapp: mensagemFinal,\n    tipo_mensagem: tipoMensagem\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-432,960],"id":"aac8897c-80ec-45e6-b876-e4ad5ebe25e5","name":"Code3"},{"parameters":{"assignments":{"assignments":[{"id":"f0b54176-d16c-406b-8455-09a7957bb042","name":"data","value":"={{ $item(\"0\").$node[\"transforma objeto\"].json[\"arguments\"][\"data_viagem\"] }}","type":"string"},{"id":"2a7110d8-595d-468f-88a5-cd74f1c84d58","name":"data","value":"={{ $item(\"0\").$node[\"Switch das funçoes\"].json[\"arguments\"][\"data_viagem_pretendida\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-416,560],"id":"d6df70dc-d1e4-4b6f-9de3-044936cfcb28","name":"Edit Fields5","onError":"continueRegularOutput"},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendText/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"=553192919794"},{"name":"text","value":"={{ $item(\"0\").$node[\"Edit Fields11\"].json[\"text\"] }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"b4bf3476-61fd-4625-a081-a54a249004d6","name":"Envia MSG Texto2","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-112,960]},{"parameters":{"method":"PUT","url":"=https://crm.rdstation.com/api/v1/deals/{{ $item(\"0\").$node[\"busca contato4\"].json[\"contacts\"][\"0\"][\"deals\"][\"0\"][\"id\"] }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"65cf63a700a768000df641b6"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"deal\": {\n    \"organization_id\": \"65d352301393f2001e30441c\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[32,960],"id":"11f6f0a1-f2e2-46f9-b9a7-cffe196cf5ee","name":"humano2","disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"ff1a6fb0-3916-4368-9a27-dfc684695c10","name":"text","value":"=celular {{ $item(\"0\").$node[\"dados_para_atendimento_humano\"].json[\"numero\"] }}\n{{ $item(\"0\").$node[\"Code3\"].json[\"mensagem_whatsapp\"] }}{{ $item(\"0\").$node[\"Code3\"].json[\"mensagem_whatsapp_completa\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-272,960],"id":"2f28aa65-116e-479c-8383-79d87c4609c0","name":"Edit Fields11"},{"parameters":{"jsCode":"// Pegar dados de entrada\nconst args = $input.first().json.arguments;\n\n// Extrair campos essenciais\nconst categoria = args.categoria_emergencia || 'nao_identificada';\nconst trigger = args.trigger_detectado || 'Não especificado';\nconst nivel = args.nivel_urgencia || 'alto';\n\n// Timestamp brasileiro\nconst agora = new Date().toLocaleString('pt-BR', {\n  day: '2-digit',\n  month: '2-digit', \n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit',\n  timeZone: 'America/Sao_Paulo'\n});\n\n// Mapear categorias e urgências\nconst categorias = {\n  'deteccao_agente': '🤖 CLIENTE IDENTIFICOU AUTOMAÇÃO',\n  'solicitacao_humano': '👤 CLIENTE SOLICITOU ATENDENTE HUMANO',\n  'insatisfacao_frustacao': '😤 CLIENTE DEMONSTRA INSATISFAÇÃO',\n  'emergencia_operacional': '🚨 EMERGÊNCIA OPERACIONAL',\n  'questao_tecnica_complexa': '🔧 QUESTÃO TÉCNICA COMPLEXA',\n  'nao_identificada': '⚠️ EMERGÊNCIA DETECTADA'\n};\n\nconst urgencias = {\n  'baixo': '🟢 BAIXA',\n  'medio': '🟡 MÉDIA', \n  'alto': '🟠 ALTA',\n  'critico': '🔴 CRÍTICA'\n};\n\n// Gerar mensagem\nconst mensagem = `🚨 *TRANSFERÊNCIA DE EMERGÊNCIA* 🚨\n${categorias[categoria]}\n🎯 *Urgência:* ${urgencias[nivel]}\n💬 *Trigger:* \"${trigger}\"\n⏰ *Horário:* ${agora}\n⚡ *AÇÃO REQUERIDA:*\n*Assumir conversa IMEDIATAMENTE*`;\n\n// RETORNO CORRETO: array de objetos\nreturn [{ \n  mensagem: mensagem,\n  categoria: categoria,\n  nivel: nivel,\n  timestamp: agora\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-432,768],"id":"82948f9c-20e2-4ac3-8031-ed780a9b8d8b","name":"Code4"},{"parameters":{"assignments":{"assignments":[{"id":"2a3e244d-f9c7-4b29-bbbd-59fad2207d09","name":"texto","value":"={{ $json.mensagem_whatsapp }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-272,768],"id":"53cf6c74-9a49-47a7-88d4-c91bab231972","name":"Edit Fields17"},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/message/sendText/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"=558592536353"},{"name":"text","value":"=cliente: {{ $json.arguments.cliente_nome }}\ntelefone:{{ $json.arguments.cliente_telefone }}\ndestino :{{ $json.arguments.destino }}\ndata: {{ $json.arguments.data_viagem }}\npesosoas: {{ $json.arguments.numero_pessoas }}\nserviço:{{ $json.arguments.tipo_servico }}\nhotel: {{ $json.arguments.hotel_pickup }}\npreço:{{ $json.arguments.valor_total }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"055a0c06-1ce4-4b4d-935a-29b29f0e64ec","name":"Envia MSG Texto3","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-48,1136]},{"parameters":{"jsCode":"// Pega a mensagem do cliente do campo correto\nconst messageText = $input.item.json.texto || '';\n\n// Função para converter nome do mês para número\nfunction getMonthNumber(monthName) {\n  const months = {\n    'janeiro': '01', 'jan': '01',\n    'fevereiro': '02', 'fev': '02',\n    'março': '03', 'mar': '03',\n    'abril': '04', 'abr': '04',\n    'maio': '05', 'mai': '05',\n    'junho': '06', 'jun': '06',\n    'julho': '07', 'jul': '07',\n    'agosto': '08', 'ago': '08',\n    'setembro': '09', 'set': '09',\n    'outubro': '10', 'out': '10',\n    'novembro': '11', 'nov': '11',\n    'dezembro': '12', 'dez': '12'\n  };\n  \n  return months[monthName.toLowerCase().trim()] || null;\n}\n\n// Função principal para detectar e extrair datas\nfunction processDateFromMessage(text) {\n  const textLower = text.toLowerCase();\n  \n  // Palavras que indicam interesse em viajar/reservar\n  const travelKeywords = [\n    'viajar', 'viagem', 'ir para', 'quero ir', 'pretendo',\n    'reservar', 'reserva', 'fechar', 'fechamento', 'confirmar',\n    'para o dia', 'no dia', 'dia', 'data', 'quando',\n    'agendado', 'marcado', 'planejando', 'programando'\n  ];\n  \n  // Verifica contexto de viagem/reserva\n  const hasTravelContext = travelKeywords.some(keyword => textLower.includes(keyword));\n  \n  // Arrays para armazenar todas as datas encontradas\n  const datesFound = [];\n  \n  // Padrão 1: DD/MM/YYYY ou DD-MM-YYYY ou DD.MM.YYYY\n  const pattern1 = /(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{4})/g;\n  let matches = text.matchAll(pattern1);\n  for (const match of matches) {\n    const day = match[1].padStart(2, '0');\n    const month = match[2].padStart(2, '0');\n    const year = match[3];\n    datesFound.push({\n      formatted: `${year}-${month}-${day}`,\n      original: match[0],\n      type: 'full',\n      day: parseInt(day),\n      month: parseInt(month),\n      year: parseInt(year)\n    });\n  }\n  \n  // Padrão 2: DD/MM ou DD-MM (assume ano atual ou próximo)\n  const pattern2 = /(\\d{1,2})[\\/\\-](\\d{1,2})(?![\\/\\-\\d])/g;\n  matches = text.matchAll(pattern2);\n  for (const match of matches) {\n    const day = match[1].padStart(2, '0');\n    const month = match[2].padStart(2, '0');\n    const currentDate = new Date();\n    const currentYear = currentDate.getFullYear();\n    const currentMonth = currentDate.getMonth() + 1;\n    \n    // Se o mês já passou, assume próximo ano\n    let year = currentYear;\n    if (parseInt(month) < currentMonth) {\n      year = currentYear + 1;\n    }\n    \n    datesFound.push({\n      formatted: `${year}-${month}-${day}`,\n      original: match[0],\n      type: 'partial',\n      day: parseInt(day),\n      month: parseInt(month),\n      year: year\n    });\n  }\n  \n  // Padrão 3: \"dia DD de MÊS\" ou \"DD de MÊS\"\n  const pattern3 = /(?:dia\\s+)?(\\d{1,2})\\s+de\\s+(janeiro|fevereiro|março|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro|jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/gi;\n  matches = text.matchAll(pattern3);\n  for (const match of matches) {\n    const day = match[1].padStart(2, '0');\n    const monthNum = getMonthNumber(match[2]);\n    if (monthNum) {\n      const currentDate = new Date();\n      const currentYear = currentDate.getFullYear();\n      const currentMonth = currentDate.getMonth() + 1;\n      \n      let year = currentYear;\n      if (parseInt(monthNum) < currentMonth) {\n        year = currentYear + 1;\n      }\n      \n      datesFound.push({\n        formatted: `${year}-${monthNum}-${day}`,\n        original: match[0],\n        type: 'text',\n        day: parseInt(day),\n        month: parseInt(monthNum),\n        year: year\n      });\n    }\n  }\n  \n  // Padrão 4: Datas relativas\n  const today = new Date();\n  \n  if (textLower.includes('hoje')) {\n    datesFound.push({\n      formatted: today.toISOString().split('T')[0],\n      original: 'hoje',\n      type: 'relative',\n      day: today.getDate(),\n      month: today.getMonth() + 1,\n      year: today.getFullYear()\n    });\n  }\n  \n  if (textLower.includes('amanhã')) {\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    datesFound.push({\n      formatted: tomorrow.toISOString().split('T')[0],\n      original: 'amanhã',\n      type: 'relative',\n      day: tomorrow.getDate(),\n      month: tomorrow.getMonth() + 1,\n      year: tomorrow.getFullYear()\n    });\n  }\n  \n  if (textLower.includes('depois de amanhã')) {\n    const dayAfter = new Date(today);\n    dayAfter.setDate(dayAfter.getDate() + 2);\n    datesFound.push({\n      formatted: dayAfter.toISOString().split('T')[0],\n      original: 'depois de amanhã',\n      type: 'relative',\n      day: dayAfter.getDate(),\n      month: dayAfter.getMonth() + 1,\n      year: dayAfter.getFullYear()\n    });\n  }\n  \n  // Padrão 5: \"próxima semana\", \"semana que vem\"\n  if (textLower.includes('próxima semana') || textLower.includes('semana que vem')) {\n    const nextWeek = new Date(today);\n    nextWeek.setDate(nextWeek.getDate() + 7);\n    datesFound.push({\n      formatted: nextWeek.toISOString().split('T')[0],\n      original: 'próxima semana',\n      type: 'relative',\n      day: nextWeek.getDate(),\n      month: nextWeek.getMonth() + 1,\n      year: nextWeek.getFullYear()\n    });\n  }\n  \n  // Padrão 6: \"final de MÊS\", \"início de MÊS\"\n  const monthPattern = /(final|fim|início|começo)\\s+de\\s+(janeiro|fevereiro|março|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro|jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/gi;\n  matches = text.matchAll(monthPattern);\n  for (const match of matches) {\n    const position = match[1].toLowerCase();\n    const monthNum = getMonthNumber(match[2]);\n    if (monthNum) {\n      const currentYear = new Date().getFullYear();\n      let day = position.includes('final') || position.includes('fim') ? '28' : '01';\n      \n      datesFound.push({\n        formatted: `${currentYear}-${monthNum}-${day}`,\n        original: match[0],\n        type: 'approximate',\n        day: parseInt(day),\n        month: parseInt(monthNum),\n        year: currentYear,\n        isApproximate: true\n      });\n    }\n  }\n  \n  // Determina a melhor data (prioriza datas completas e contexto de viagem)\n  let bestDate = null;\n  if (datesFound.length > 0) {\n    // Prioriza datas completas sobre parciais\n    bestDate = datesFound.find(d => d.type === 'full') || \n               datesFound.find(d => d.type === 'text') ||\n               datesFound.find(d => d.type === 'partial') ||\n               datesFound[0];\n  }\n  \n  // Calcula confiança\n  let confidence = 'none';\n  if (bestDate) {\n    if (hasTravelContext && bestDate.type === 'full') {\n      confidence = 'high';\n    } else if (hasTravelContext || bestDate.type === 'full') {\n      confidence = 'medium';\n    } else {\n      confidence = 'low';\n    }\n  }\n  \n  return {\n    hasDate: bestDate !== null,\n    date: bestDate ? bestDate.formatted : null,\n    dateOriginal: bestDate ? bestDate.original : null,\n    dateType: bestDate ? bestDate.type : null,\n    allDatesFound: datesFound,\n    confidence: confidence,\n    hasTravelContext: hasTravelContext,\n    shouldUpdateCRM: bestDate !== null && confidence !== 'none',\n    originalMessage: text\n  };\n}\n\n// Processa a mensagem\nconst result = processDateFromMessage(messageText);\n\n// Prepara output final com todas as informações úteis\nconst output = {\n  // Informações principais\n  hasDate: result.hasDate,\n  date: result.date,\n  dateOriginal: result.dateOriginal,\n  confidence: result.confidence,\n  shouldUpdateCRM: result.shouldUpdateCRM,\n  \n  // Informações adicionais para o CRM\n  dateFormatted: result.date, // Formato YYYY-MM-DD para o CRM\n  dateBR: result.date ? result.date.split('-').reverse().join('/') : null, // Formato DD/MM/YYYY\n  \n  // Metadados\n  messageProcessed: messageText,\n  dateType: result.dateType,\n  hasTravelContext: result.hasTravelContext,\n  totalDatesFound: result.allDatesFound.length,\n  \n  // Para debug (opcional)\n  allDates: result.allDatesFound\n};\n\n// Retorna o resultado processado\nreturn output;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3152,1408],"id":"9fc1ca3e-c17c-4149-b646-cbf1e3ca5195","name":"Code"},{"parameters":{"assignments":{"assignments":[{"id":"56ddf710-f65b-44e6-bfdc-ee6ebf1ddc0b","name":"texto","value":"={{ $item(\"0\").$node[\"HTTP Request6\"].json[\"content\"][\"0\"][\"text\"][\"value\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3328,1408],"id":"b1dc441d-84e9-488c-81b9-592319dec965","name":"Edit Fields1"},{"parameters":{"assignments":{"assignments":[{"id":"4cd8511b-5016-4b56-becf-ee5ac06af46f","name":"text","value":"imagem","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6224,2096],"id":"93607c06-891b-4fd2-8c13-664d79041c53","name":"Edit Fields18"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3968,1440],"id":"71ffe04b-1246-4974-9a22-5f023b35dafd","name":"No Operation, do nothing2"},{"parameters":{"jsCode":"// Lógica para tratar mensagens mencionadas no N8N\n// Com suporte a áudio mencionado\n\n// ADIÇÃO: Verifica se a mensagem vem do OpenAI3 (áudio transcrito)\n// Usa verificação de entrada para detectar se vem do OpenAI3\nlet mensagemVemDoOpenAI3 = false;\nlet transcricaoTexto = \"\";\n\n// Verifica se existe uma entrada que não seja do Webhook EVO\nconst entradas = Object.keys($input.all());\nif (entradas.length > 1) {\n  // Se tem mais de uma entrada, verifica se uma delas tem texto transcrito\n  for (let entrada of entradas) {\n    if (entrada !== 'Webhook EVO') {\n      const dadosEntrada = $input.all()[entrada];\n      if (dadosEntrada && dadosEntrada[0] && dadosEntrada[0].json && dadosEntrada[0].json.text) {\n        mensagemVemDoOpenAI3 = true;\n        transcricaoTexto = dadosEntrada[0].json.text;\n        break;\n      }\n    }\n  }\n}\n\n// SEU CÓDIGO ORIGINAL (sem modificações):\n// Extrai a mensagem atual\nlet mensagemAtual = \"\";\n\n// Se vem do OpenAI3 (áudio transcrito), usa a transcrição\nif (mensagemVemDoOpenAI3) {\n  mensagemAtual = transcricaoTexto;\n} else {\n  // Senão, usa a mensagem normal do webhook\n  mensagemAtual = $('Webhook EVO').first().json.body.data.message.conversation || \"\";\n}\n\n// Inicializa variáveis para menção\nlet mensagemMencionada = \"\";\nlet audioMencionadoId = null;\nlet tipoMencao = \"texto\"; // pode ser: \"texto\", \"audio\"\n\n// Verifica se tem mensagem mencionada\nif ($('Webhook EVO').first().json.body.data.contextInfo && $('Webhook EVO').first().json.body.data.contextInfo.quotedMessage) {\n  \n  const quotedMessage = $('Webhook EVO').first().json.body.data.contextInfo.quotedMessage;\n  \n  // Verifica se é texto\n  if (quotedMessage.conversation) {\n    mensagemMencionada = quotedMessage.conversation;\n    tipoMencao = \"texto\";\n  }\n  // Verifica se é áudio\n  else if (quotedMessage.audioMessage) {\n    // Captura o ID do áudio (stanzaId) para buscar o base64\n    audioMencionadoId = $('Webhook EVO').first().json.body.data.contextInfo.stanzaId;\n    mensagemMencionada = \"[ÁUDIO MENCIONADO]\";\n    tipoMencao = \"audio\";\n  }\n  // Outros tipos de mídia (opcional)\n  else if (quotedMessage.imageMessage) {\n    mensagemMencionada = \"[IMAGEM MENCIONADA]\";\n    tipoMencao = \"imagem\";\n  }\n  else if (quotedMessage.videoMessage) {\n    mensagemMencionada = \"[VÍDEO MENCIONADO]\";\n    tipoMencao = \"video\";\n  }\n  else if (quotedMessage.documentMessage) {\n    mensagemMencionada = \"[DOCUMENTO MENCIONADO]\";\n    tipoMencao = \"documento\";\n  }\n}\n\n// Variável para a mensagem final\nlet mensagemFinal = mensagemAtual;\n\n// Se existe menção, junta as mensagens\nif (mensagemMencionada) {\n  if (tipoMencao === \"audio\") {\n    mensagemFinal = `ÁUDIO MENCIONADO (ID: ${audioMencionadoId})\n\nmensagem mencionada anterior: \"${mensagemAtual}\"\n\nINSTRUÇÃO: O cliente está respondendo a um áudio anterior. Você precisa transcrever o áudio usando o ID fornecido antes de responder.`;\n  } else {\n    mensagemFinal = `Mensagem mencionada anterior: \"${mensagemMencionada}\"\n\nReferenciando mensagem mencionada: \"${mensagemAtual}\"\n\nResponda considerando que a segunda mensagem se refere à primeira.`;\n  }\n}\n\n// Retorna o resultado\nreturn {\n  mensagemTratada: mensagemFinal,\n  temMencao: mensagemMencionada ? true : false,\n  tipoMencao: tipoMencao,\n  mensagemOriginal: mensagemAtual,\n  mensagemMencionada: mensagemMencionada,\n  audioMencionadoId: audioMencionadoId,\n  // Para usar no próximo nó se for áudio\n  precisaTranscrever: tipoMencao === \"audio\"\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6784,2560],"id":"fd71f853-dce8-45fa-9081-c1c21ca7316f","name":"Code6"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-6176,2624],"id":"7ec72ddc-bdb6-4b90-aa10-3bdabb9d9508","name":"OpenAI2","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"mimeType":"audio/ogg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-6288,2624],"id":"845958c3-1d58-4fd4-9454-9fe71d021b89","name":"Convert to File2"},{"parameters":{"method":"=POST","url":"={{ $('Webhook EVO').item.json.body.server_url }}/chat/getBase64FromMediaMessage/{{ $('Webhook EVO').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook EVO').item.json.body.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.ID }}\"\n    }\n  },\n  \"convertToMp4\": false\n} ","options":{"redirect":{"redirect":{}}}},"id":"964b075e-5663-41a6-a682-68c802fc7a29","name":"Coloque o ID da mensagem aqui2","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6416,2624]},{"parameters":{"jsCode":"// Código para juntar áudio transcrito com mensagem atual\n// Usado após a transcrição do áudio mencionado\n\n// Pega a transcrição do áudio do nó anterior (OpenAI2)\nlet transcricaoAudio = $('OpenAI2').first().json.text || \"\";\n\n// Pega os dados do nó de tratamento inicial (Code6)\nlet dadosTratamento = $('Code6').first().json;\n\n// Pega a mensagem atual do cliente\nlet mensagemAtual = dadosTratamento.mensagemOriginal || \"\";\n\n// Monta a mensagem final de forma mais concisa\nlet mensagemFinalComAudio = `Mensagem anterior mencionada: \"${transcricaoAudio}\"\n\nReferenciando a anterior: \"${mensagemAtual}\"\n\nResponda considerando que a segunda mensagem se refere à primeira.`;\n\n// Retorna o resultado final\nreturn {\n  mensagemTratada: mensagemFinalComAudio,\n  transcricaoAudio: transcricaoAudio,\n  mensagemOriginal: mensagemAtual,\n  temMencao: true,\n  tipoMencao: \"audio_transcrito\"\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6048,2624],"id":"c5f2cc22-3395-40dd-97a9-5d5ea42e331c","name":"Code10"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6ac710ea-9b70-48a3-a6e5-07684f5ef716","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6944,2496],"id":"2b68ba83-eb5e-496a-9d1c-94acd07958d8","name":"verifica se e audio"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-6192,2400],"id":"12ab5cf4-1f50-4d7b-936e-1d1f6d70fc02","name":"OpenAI3","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"mimeType":"audio/ogg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-6304,2400],"id":"52741aec-acaa-4bdf-9268-759390735c61","name":"Convert to File4"},{"parameters":{"method":"=POST","url":"={{ $('Webhook EVO').item.json.body.server_url }}/chat/getBase64FromMediaMessage/{{ $('Webhook EVO').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook EVO').item.json.body.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.ID }}\"\n    }\n  },\n  \"convertToMp4\": false\n} ","options":{"redirect":{"redirect":{}}}},"id":"ddff6b41-2715-4a7e-8017-b610e356b0eb","name":"Coloque o ID da mensagem aqui3","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6432,2400]},{"parameters":{"assignments":{"assignments":[{"id":"348694b3-260f-4b2f-be3d-60d717f2163b","name":"ID","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"key\"][\"id\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6544,2400],"id":"f39069e3-a8b1-4adc-98b1-3499f2ebd83a","name":"Edit Fields20"},{"parameters":{"content":"## SISTEMA LOGICA DE MENÇÃO DE MENSAGEM","height":460,"width":1200,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-6944,2336],"id":"d68748a4-7561-4216-94e8-f60d751c1ad5","name":"Sticky Note8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"387ff8d5-12d6-480b-96e7-725528d817d1","leftValue":"={{ $json.precisaTranscrever }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6672,2560],"id":"a8faf4d0-5607-4ad4-8e1f-aa434265a24d","name":"MENS. MENCIONADA E AUDIO"},{"parameters":{"assignments":{"assignments":[{"id":"53bc514c-3aeb-46f8-b495-105ed2728139","name":"text","value":"={{ $json.mensagemTratada }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5904,2544],"id":"c70562c4-e41f-4245-93b8-4bbab3ae5d7d","name":"Edit Fields15"},{"parameters":{"assignments":{"assignments":[{"id":"348694b3-260f-4b2f-be3d-60d717f2163b","name":"ID","value":"={{ $item(\"0\").$node[\"Code6\"].json[\"audioMencionadoId\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6528,2624],"id":"cbf13be1-8572-467f-b94e-2c0e8ebcc4d8","name":"Edit Fields19"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ff9627ec-a2d6-4bba-8cf8-37e359f5f583","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"contextInfo\"][\"quotedMessage\"] }}","rightValue":"","operator":{"type":"object","operation":"notExists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7216,2096],"id":"35147cb9-972b-4ef4-8127-6f564ce0548d","name":"If"},{"parameters":{"height":340,"width":1220,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4208,1248],"id":"0dce21a3-f9ad-4f76-b925-a4796668c09c","name":"Sticky Note5"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"dc681102-c19c-4e93-ab9a-c5b23ab59d35","leftValue":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"data\"][\"contextInfo\"][\"quotedMessage\"][\"productMessage\"][\"product\"][\"productImage\"][\"mimetype\"] }}","rightValue":"image","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6896,2240],"id":"d7d69b1c-7117-46fb-a90d-6c683cad9705","name":"If1"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-5632,1936],"id":"e1a0ff65-0ba0-47b9-af67-4c117cfe0f68","name":"Wait1","webhookId":"83e602b7-5df7-44ca-abb4-4672a7f31061"},{"parameters":{"jsCode":"// Pegar todos os items do Code6\nconst allMessages = $('Code14').all();\n\n// Formatar cada mensagem para adicionar na thread\nconst formattedMessages = allMessages.map((item, index) => {\n  // Extrair dados da mensagem\n  const message = item.json.message;\n  const type = item.json.type; // 'user' ou 'assistant'\n  const fromMe = item.json.fromMe;\n  \n  // Determinar o role correto\n  // Se type existe, usar ele. Senão, basear em fromMe\n  let role = type || (fromMe ? 'assistant' : 'user');\n  if (role === 'lead') {\n    role = 'user';\n  }\n  \n  return {\n    json: {\n      // Dados para adicionar na thread\n      role: role,\n      content: message,\n      \n      // Metadados adicionais\n      messageIndex: index,\n      isUser: role === 'user',\n      isAssistant: role === 'assistant',\n      fromMe: fromMe,\n      \n      // Dados para controle\n      totalMessages: allMessages.length,\n      isLastMessage: index === allMessages.length - 1,\n      isFirstMessage: index === 0\n    }\n  };\n});\n\n// Retornar cada mensagem como um item separado\nreturn formattedMessages;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3024,2480],"id":"b09f6a50-bc4f-4585-a4f2-3f765aa8bd6b","name":"Code11"},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/chat/findMessages/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"where\": {\n    \"key\": {\n      \"remoteJid\": \"{{ $item(0).$node[\"dados_para_atendimento_humano\"].json[\"message\"][\"chat_id\"] }}\"\n    }\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4144,2368],"id":"c72d4533-9127-44b8-be93-0e46423055f4","name":"BUSCA CONVERSA2"},{"parameters":{"fieldToSplitOut":"base64","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-3504,2480],"id":"ebb0d02b-754a-4519-b2d5-3cbd5b0d3e09","name":"Split Out"},{"parameters":{"method":"POST","url":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"server_url\"] }}/chat/getBase64FromMediaMessage/{{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"instance\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $item(\"0\").$node[\"Webhook EVO\"].json[\"body\"][\"apikey\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.audioId }}\"\n    }\n  }\n}","options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3632,2480],"id":"5ae54ba6-f69b-401c-925a-bcbbf5eb631e","name":"BUSCA base "},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-3264,2480],"id":"e0bde943-da8b-4c91-97f1-19418e109e2f","name":"OpenAI4","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"mimeType":"audio/ogg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3392,2480],"id":"86ec8f07-3f67-451e-b76b-164d25fac773","name":"Convert to File5"},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $item(\"0\").$node[\"criar thread2\"].json[\"id\"] }}/messages","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"},{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"role","value":"={{ $json.role }}"},{"name":"content","value":"={{ $json.content }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2912,2480],"id":"2d46f24f-4a50-45e4-bc64-2832a1682c9e","name":"user1","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}},"onError":"continueRegularOutput"},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/threads","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"},{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4384,2368],"id":"dee532fe-6201-4608-9107-7d1a8950477f","name":"criar thread2","credentials":{"openAiApi":{"id":"cLLBGZkYrIIGqXIA","name":"filipe-cocoverde"}}},{"parameters":{"operation":"update","tableId":"FILIPE","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"Data Handler1\"].json[\"data\"][\"remoteJid\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"thread_id","fieldValue":"={{ $item(\"0\").$node[\"criar thread2\"].json[\"id\"] }}"},{"fieldId":"possui_thread","fieldValue":"true"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-4272,2368],"id":"71c7710e-ac53-4ed2-8d49-b596fcc463ed","name":"thread db2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"vG6wGZzyHwSEWYAs","name":"Supabase account"}}},{"parameters":{"jsCode":"// Pegar os records do input\nconst messages = $('BUSCA CONVERSA2').first().json.messages.records;\n\n// Processar mensagens de forma simplificada\nconst processedMessages = messages.map(msg => {\n  // Extrair conteúdo baseado no tipo\n  let content = '';\n  \n  switch(msg.messageType) {\n    case 'conversation':\n      content = msg.message.conversation;\n      break;\n    case 'audioMessage':\n      // Para áudio, usar o ID dentro de key\n      content = msg.key.id;\n      break;\n    case 'documentMessage':\n      content = `[Documento: ${msg.message.documentMessage?.fileName || 'arquivo'}]`;\n      break;\n    case 'imageMessage':\n      content = `[Imagem${msg.message.imageMessage?.caption ? ': ' + msg.message.imageMessage.caption : ''}]`;\n      break;\n    case 'videoMessage':\n      content = `[Vídeo${msg.message.videoMessage?.caption ? ': ' + msg.message.videoMessage.caption : ''}]`;\n      break;\n    default:\n      content = '[Mensagem]';\n  }\n  \n  // Retornar objeto simplificado\n  return {\n    message: content,\n    fromMe: msg.key.fromMe,\n    timestamp: msg.messageTimestamp,\n    type: msg.key.fromMe ? 'assistant' : 'lead',\n    isAudio: msg.messageType === 'audioMessage'\n  };\n});\n\n// Ordenar por timestamp (mais antigas primeiro)\nprocessedMessages.sort((a, b) => a.timestamp - b.timestamp);\n\n// Retornar no formato esperado pelo n8n\nreturn processedMessages.map(msg => ({\n  json: {\n    message: msg.message,\n    fromMe: msg.fromMe,\n    type: msg.type,\n    isAudio: msg.isAudio\n  }\n}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4032,2368],"id":"b6b5ca67-b0c9-494f-bb5b-65cb2dec04fe","name":"Code12"},{"parameters":{"jsCode":"// Pegar todos os itens do node anterior\nconst items = $input.all();\n\n// Filtrar apenas os áudios\nconst audioMessages = items.filter(item => item.json.isAudio === true);\n\n// Se não houver áudios, retornar um item vazio para o IF processar\nif (audioMessages.length === 0) {\n  return [{\n    json: {\n      hasAudio: false,\n      message: \"Sem áudios para processar\"\n    }\n  }];\n}\n\n// Retornar CADA ÁUDIO como um item separado\nreturn audioMessages.map(audio => ({\n  json: {\n    audioId: audio.json.message,  // ID do áudio no Evolution\n    fromMe: audio.json.fromMe,\n    type: audio.json.type,\n    isAudio: true\n  }\n}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3904,2368],"id":"9410bf84-a429-465b-90de-8c71824ea6db","name":"Code13"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"708b610d-037d-46e1-8a70-bef95fee6290","leftValue":"={{ $item(\"0\").$node[\"Code13\"].json[\"isAudio\"] }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3792,2368],"id":"93ae8a3d-62a0-4422-89bc-26458f67f7f6","name":"If9"},{"parameters":{"jsCode":"// Versão simplificada - assumindo que temos 2 inputs\nconst messages = $items(\"Code12\");\nconst transcriptions = $input.all(\"OpenAI\");\n\nlet transcriptionIndex = 0;\n\nreturn messages.map(msg => {\n  if (msg.json.isAudio === true && transcriptionIndex < transcriptions.length) {\n    const text = transcriptions[transcriptionIndex].json.text;\n    transcriptionIndex++;\n    \n    return {\n      json: {\n        message: text,\n        fromMe: msg.json.fromMe,\n        type: msg.json.type,\n        wasAudio: true\n      }\n    };\n  }\n  \n  return {\n    json: msg.json\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3152,2480],"id":"e99d3387-f58b-4f09-9c4d-2eedb95d7015","name":"Code14"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-2784,2480],"id":"7e6a4996-6875-40d7-b1b7-69fcb17170b8","name":"Wait2","webhookId":"6a9964c5-7637-4ba7-a4c6-9159dd7ad753"},{"parameters":{"content":"## ADICIONA CONTEXTO ANTES DA ia \n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":400,"width":1880},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4528,2256],"id":"92a45527-3dab-406e-9379-2f1c09e89bf2","name":"Sticky Note6"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-4512,2368],"id":"f894b49e-59ac-424b-b7bb-fc58edde76bc","name":"Wait6","webhookId":"93acc4e0-2b37-444f-aa5b-b4084883e7bc"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2832,1328],"id":"f6a1b0c6-fa62-4828-bb77-ec760cb432ae","name":"No Operation, do nothing6"}],"connections":{"Message Type1":{"main":[[{"node":"Text Memory1","type":"main","index":0}],[{"node":"Edit Fields9","type":"main","index":0}],[{"node":"Edit Fields10","type":"main","index":0}],[{"node":"Switch","type":"main","index":0}]]},"Audio Memory":{"main":[[{"node":"Merge","type":"main","index":1}]]},"OpenAI":{"main":[[{"node":"Audio Memory","type":"main","index":0}]]},"Text Memory1":{"main":[[{"node":"Edit Fields6","type":"main","index":0}]]},"Supabase":{"main":[[{"node":"If5","type":"main","index":0}]]},"Gerar sessionID":{"main":[[{"node":"HTTP Request4","type":"main","index":0}]]},"Supabase1":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"Date & Time1":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Get Dados":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Variáveis":{"main":[[{"node":"Date & Time1","type":"main","index":0}]]},"If5":{"main":[[{"node":"Supabase9","type":"main","index":0}],[{"node":"Gerar sessionID","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Variáveis","type":"main","index":0}]]},"Webhook EVO":{"main":[[{"node":"Filter1","type":"main","index":0}]]},"Data Handler1":{"main":[[{"node":"EXCLUI DADOS","type":"main","index":0}]]},"verifivca thread":{"main":[[{"node":"verifica se e imagemn","type":"main","index":0}],[{"node":"criar thread","type":"main","index":0}]]},"criar thread":{"main":[[{"node":"thread db","type":"main","index":0}]]},"thread db":{"main":[[{"node":"If5","type":"main","index":0}]]},"HTTP Request1":{"main":[[{"node":"id da mensagem","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Listando as MSg1","type":"main","index":0}]]},"Listando as MSg1":{"main":[[{"node":"Verifica os IDs da MSG1","type":"main","index":0}]]},"Verifica os IDs da MSG1":{"main":[[{"node":"Criar uma Run1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Criar uma Run1":{"main":[[{"node":"Listar a RUN2","type":"main","index":0}]]},"Verificar o Status da Run1":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"Pega a Resposta do Assistente (IA)1","type":"main","index":0}],[{"node":"Wait4","type":"main","index":0}],[{"node":"set feuntion","type":"main","index":0}],[{"node":"Wait4","type":"main","index":0}],[{"node":"Wait4","type":"main","index":0}],[{"node":"Wait4","type":"main","index":0}],[{"node":"Wait4","type":"main","index":0}],[{"node":"Wait4","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Listar a RUN2","type":"main","index":0}]]},"Pega a Resposta do Assistente (IA)1":{"main":[[{"node":"HTTP Request2","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Transformando em um Array1":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"respostas","type":"main","index":0}]]},"Envia MSG Texto1":{"main":[[{"node":"Wait5","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Listar a RUN2":{"main":[[{"node":"Verificar o Status da Run1","type":"main","index":0}]]},"set feuntion":{"main":[[{"node":"Split das funtion","type":"main","index":0}]]},"Split das funtion":{"main":[[{"node":"Loop1","type":"main","index":0}]]},"transforma objeto":{"main":[[{"node":"Switch das funçoes","type":"main","index":0}]]},"Loop1":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"transforma objeto","type":"main","index":0}]]},"Switch das funçoes":{"main":[[{"node":"nome","type":"main","index":0}],[{"node":"Supabase5","type":"main","index":0}],[{"node":"Supabase6","type":"main","index":0}],[{"node":"Supabase3","type":"main","index":0}],[{"node":"lista contato1","type":"main","index":0}],[{"node":"Edit Fields5","type":"main","index":0}],[{"node":"Code4","type":"main","index":0}],[{"node":"Code3","type":"main","index":0}],[{"node":"Code3","type":"main","index":0}],[{"node":"Edit Fields5","type":"main","index":0}]]},"output":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Summarize","type":"main","index":0}]]},"Summarize":{"main":[[{"node":"format output","type":"main","index":0}]]},"format output":{"main":[[{"node":"Loop1","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"resposta fuction","type":"main","index":0}]]},"output1":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"resposta fuction":{"main":[[{"node":"Wait4","type":"main","index":0}]]},"Supabase5":{"main":[[{"node":"output2","type":"main","index":0}]]},"output2":{"main":[[{"node":"Merge1","type":"main","index":2}]]},"Supabase6":{"main":[[{"node":"output3","type":"main","index":0}]]},"output3":{"main":[[{"node":"Merge1","type":"main","index":3}]]},"EXCLUI DADOS":{"main":[[{"node":"Supabase7","type":"main","index":0}],[{"node":"dados_para_atendimento_humano","type":"main","index":0}]]},"Switch Block1":{"main":[[{"node":"verifivca thread","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Switch":{"main":[[{"node":"PARA IA1","type":"main","index":0}],[{"node":"Verificar Atendimento1","type":"main","index":0}]]},"Verificar Atendimento1":{"main":[[{"node":"Switch Block1","type":"main","index":0}]]},"dados_para_atendimento_humano":{"main":[[{"node":"busca contato4","type":"main","index":0}]]},"Filter1":{"main":[[{"node":"Data Handler1","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"upload imagem","type":"main","index":0}]]},"upload imagem":{"main":[[{"node":"Edit Fields18","type":"main","index":0}]]},"verifica se e imagemn":{"main":[[{"node":"set imagem","type":"main","index":0}],[{"node":"HTTP Request1","type":"main","index":0}]]},"set imagem":{"main":[[{"node":"insere iamgem","type":"main","index":0}]]},"insere iamgem":{"main":[[{"node":"id da imagem","type":"main","index":0}]]},"id da imagem":{"main":[[{"node":"Wait3","type":"main","index":0}]]},"id da mensagem":{"main":[[{"node":"Wait3","type":"main","index":0}]]},"HTTP Request2":{"main":[[{"node":"Transformando em um Array1","type":"main","index":0}]]},"qual tag":{"main":[[{"node":"Edit Fields8","type":"main","index":0}]]},"Supabase9":{"main":[[{"node":"Get Dados","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"Edit Fields6":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Edit Fields8":{"main":[[{"node":"Merge2","type":"main","index":8}]]},"Merge2":{"main":[[{"node":"Summarize","type":"main","index":0}]]},"Coloque o ID da mensagem aqui":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Edit Fields9":{"main":[[{"node":"Coloque o ID da mensagem aqui","type":"main","index":0}]]},"Coloque o ID da mensagem aqui1":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Edit Fields10":{"main":[[{"node":"Coloque o ID da mensagem aqui1","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"output1","type":"main","index":0}],[{"node":"atualiza etapa objeção","type":"main","index":0}],[{"node":"atualiza etapa proposta","type":"main","index":0}],[{"node":"atualiza etapa reserva","type":"main","index":0}],[{"node":"atualiza etapa reserva","type":"main","index":0}],[{"node":"output1","type":"main","index":0}],[{"node":"output1","type":"main","index":0}]]},"atualiza tag2":{"main":[[{"node":"move negocio2","type":"main","index":0}]]},"nome":{"main":[[{"node":"output","type":"main","index":0}]]},"deltar tag1":{"main":[[{"node":"atualiza tag2","type":"main","index":0}]]},"HTTP Request4":{"main":[[{"node":"Supabase1","type":"main","index":0}]]},"atualiza etapa objeção":{"main":[[{"node":"Supabase12","type":"main","index":0}]]},"Supabase3":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"respostas":{"main":[[{"node":"extrai o link da imagem","type":"main","index":0}],[{"node":"extrai o link do video","type":"main","index":0}],[{"node":"extrai o link do documento","type":"main","index":0}],[{"node":"extrai o link do audio","type":"main","index":0}],[{"node":"Envia MSG Texto1","type":"main","index":0}]]},"extrai o link do audio":{"main":[[{"node":"envia audio","type":"main","index":0}]]},"envia audio":{"main":[[{"node":"Wait5","type":"main","index":0}]]},"extrai o link do documento":{"main":[[{"node":"envia audio1","type":"main","index":0}]]},"extrai o link do video":{"main":[[{"node":"envia audio3","type":"main","index":0}]]},"extrai o link da imagem":{"main":[[{"node":"envia audio2","type":"main","index":0}]]},"envia audio1":{"main":[[{"node":"Wait5","type":"main","index":0}]]},"envia audio3":{"main":[[{"node":"Wait5","type":"main","index":0}]]},"envia audio2":{"main":[[{"node":"Wait5","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Edit Fields14","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"atualiza etapa reserva":{"main":[[{"node":"Supabase10","type":"main","index":0}]]},"atualiza etapa proposta":{"main":[[{"node":"Supabase11","type":"main","index":0}]]},"busca contato4":{"main":[[{"node":"If3","type":"main","index":0}]]},"qual tag1":{"main":[[{"node":"If2","type":"main","index":0}]]},"If2":{"main":[[{"node":"If","type":"main","index":0}],[{"node":"No Operation, do nothing3","type":"main","index":0}]]},"If3":{"main":[[{"node":"busca negocio","type":"main","index":0}],[{"node":"BUSCA CONVERSA","type":"main","index":0}]]},"BUSCA CONVERSA":{"main":[[{"node":"If4","type":"main","index":0}]]},"If4":{"main":[[{"node":"If","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"atualiza crm":{"main":[[{"node":"atualiza crm2","type":"main","index":0}]]},"Edit Fields13":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"AI Agent1":{"main":[[{"node":"Edit Fields14","type":"main","index":0}]]},"Edit Fields7":{"main":[[{"node":"Merge2","type":"main","index":7}]]},"busca negocio":{"main":[[{"node":"qual tag1","type":"main","index":0}]]},"Supabase11":{"main":[[{"node":"output1","type":"main","index":0}]]},"Supabase10":{"main":[[{"node":"output1","type":"main","index":0}]]},"Supabase12":{"main":[[{"node":"output1","type":"main","index":0}]]},"Envia MSG Texto":{"main":[[{"node":"humano1","type":"main","index":0}]]},"When clicking ‘Test workflow’":{"main":[[{"node":"HTTP Request5","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Edit Fields16","type":"main","index":0}]]},"HTTP Request5":{"main":[[{"node":"Code2","type":"main","index":0}]]},"atualiza crm2":{"main":[[{"node":"Edit Fields7","type":"main","index":0}]]},"lista contato1":{"main":[[{"node":"id do contato3","type":"main","index":0}]]},"id do contato3":{"main":[[{"node":"qual tag","type":"main","index":0}]]},"busca thread":{"main":[[{"node":"humano ou IA","type":"main","index":0}]]},"humano ou IA":{"main":[[{"node":"HTTP Request3","type":"main","index":0}],[{"node":"HTTP Request6","type":"main","index":0}]]},"PARA IA1":{"main":[[{"node":"humano","type":"main","index":0}]]},"humano":{"main":[[{"node":"busca thread","type":"main","index":0}],[{"node":"No Operation, do nothing2","type":"main","index":0}]]},"No Operation, do nothing":{"main":[[{"node":"busca thread","type":"main","index":0}]]},"humano1":{"main":[[{"node":"No Operation, do nothing5","type":"main","index":0}]]},"Edit Fields5":{"main":[[{"node":"atualiza crm","type":"main","index":0}]]},"Envia MSG Texto2":{"main":[[{"node":"humano2","type":"main","index":0}]]},"Code3":{"main":[[{"node":"Edit Fields11","type":"main","index":0}]]},"Edit Fields11":{"main":[[{"node":"Envia MSG Texto2","type":"main","index":0}]]},"Code4":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"Envia MSG Texto","type":"main","index":0}]]},"HTTP Request6":{"main":[[{"node":"Edit Fields1","type":"main","index":0}],[{"node":"No Operation, do nothing6","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Edit Fields18":{"main":[[{"node":"Merge","type":"main","index":2}]]},"Code6":{"main":[[{"node":"MENS. MENCIONADA E AUDIO","type":"main","index":0}]]},"OpenAI2":{"main":[[{"node":"Code10","type":"main","index":0}]]},"Convert to File2":{"main":[[{"node":"OpenAI2","type":"main","index":0}]]},"Coloque o ID da mensagem aqui2":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"Code10":{"main":[[{"node":"Edit Fields15","type":"main","index":0}]]},"verifica se e audio":{"main":[[{"node":"Edit Fields20","type":"main","index":0}],[{"node":"Code6","type":"main","index":0}]]},"OpenAI3":{"main":[[{"node":"Code6","type":"main","index":0}]]},"Convert to File4":{"main":[[{"node":"OpenAI3","type":"main","index":0}]]},"Coloque o ID da mensagem aqui3":{"main":[[{"node":"Convert to File4","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Coloque o ID da mensagem aqui3","type":"main","index":0}]]},"MENS. MENCIONADA E AUDIO":{"main":[[{"node":"Edit Fields15","type":"main","index":0}],[{"node":"Edit Fields19","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Coloque o ID da mensagem aqui2","type":"main","index":0}]]},"If":{"main":[[{"node":"Message Type1","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"Edit Fields15":{"main":[[{"node":"Merge","type":"main","index":3}]]},"If1":{"main":[[{"node":"Message Type1","type":"main","index":0}],[{"node":"verifica se e audio","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Code11":{"main":[[{"node":"user1","type":"main","index":0}]]},"BUSCA CONVERSA2":{"main":[[{"node":"Code12","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Convert to File5","type":"main","index":0}]]},"BUSCA base ":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"OpenAI4":{"main":[[{"node":"Code14","type":"main","index":0}]]},"Convert to File5":{"main":[[{"node":"OpenAI4","type":"main","index":0}]]},"user1":{"main":[[{"node":"Wait2","type":"main","index":0}]]},"criar thread2":{"main":[[{"node":"thread db2","type":"main","index":0}]]},"thread db2":{"main":[[{"node":"BUSCA CONVERSA2","type":"main","index":0}]]},"Code12":{"main":[[{"node":"Code13","type":"main","index":0}]]},"Code13":{"main":[[{"node":"If9","type":"main","index":0}]]},"If9":{"main":[[{"node":"Code14","type":"main","index":0}],[{"node":"BUSCA base ","type":"main","index":0}]]},"Code14":{"main":[[{"node":"Code11","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"criar thread2","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"HTTP Request3":{"main":[[],[{"node":"No Operation, do nothing6","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"rd staion negocios":[{"json":{"deal_stages":[{"_id":"65cf63fa0bc1ec0019d3470c","id":"65cf63fa0bc1ec0019d3470c","name":"inicio atendimento","nickname":"IA","order":1,"configuration":[],"created_at":"2024-02-16T10:32:42.971-03:00","updated_at":"2024-02-28T09:15:02.848-03:00","instance_id":"65cf63a600a768000df641b3","objective":null,"description":null,"deal_pipeline":{"id":"65cf63fa0bc1ec0019d3470b","name":"Funil vendas Receptivo","order":1}},{"_id":"65cf63fb0bc1ec0019d3470e","id":"65cf63fb0bc1ec0019d3470e","name":"objeçoes","nickname":"O","order":2,"configuration":[],"created_at":"2024-02-16T10:32:43.015-03:00","updated_at":"2024-02-28T09:19:35.450-03:00","instance_id":"65cf63a600a768000df641b3","objective":null,"description":null,"deal_pipeline":{"id":"65cf63fa0bc1ec0019d3470b","name":"Funil vendas Receptivo","order":1}},{"_id":"65cf63fb0bc1ec0019d3470f","id":"65cf63fb0bc1ec0019d3470f","name":"Proposta enviada","nickname":"PE","order":3,"configuration":[],"created_at":"2024-02-16T10:32:43.057-03:00","updated_at":"2024-02-28T09:15:49.718-03:00","instance_id":"65cf63a600a768000df641b3","objective":null,"description":null,"deal_pipeline":{"id":"65cf63fa0bc1ec0019d3470b","name":"Funil vendas Receptivo","order":1}},{"_id":"65cf63fb0bc1ec0019d34710","id":"65cf63fb0bc1ec0019d34710","name":"Reserva","nickname":"R","order":4,"configuration":[],"created_at":"2024-02-16T10:32:43.090-03:00","updated_at":"2024-02-28T10:11:40.485-03:00","instance_id":"65cf63a600a768000df641b3","objective":null,"description":null,"deal_pipeline":{"id":"65cf63fa0bc1ec0019d3470b","name":"Funil vendas Receptivo","order":1}},{"_id":"65df25879f19ae0020e50b04","id":"65df25879f19ae0020e50b04","name":"Perdido","nickname":"P","order":5,"configuration":[],"created_at":"2024-02-28T09:22:31.240-03:00","updated_at":"2024-02-28T10:11:40.503-03:00","instance_id":"65cf63a600a768000df641b3","objective":null,"description":null,"deal_pipeline":{"id":"65cf63fa0bc1ec0019d3470b","name":"Funil vendas Receptivo","order":1}}],"total":5,"has_more":false}}],"HTTP Request6":[{"json":{"id":"msg_Kd5QWjTbzSWKsDav20hC8NNr","object":"thread.message","created_at":1751990289,"assistant_id":null,"thread_id":"thread_CmDAiqxFm8dIDe7vTvqr3mEr","run_id":null,"role":"user","content":[{"type":"text","text":{"value":"Legal. Vou passa ro contato para outros dois casais que irão tbm.","annotations":[]}}],"attachments":[],"metadata":{}}}],"Webhook EVO":[{"json":{"headers":{"host":"web1.oferta24h.site","user-agent":"axios/1.7.9","content-length":"921","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"web1.oferta24h.site","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"0c38806af12d","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"grupo","data":{"key":{"remoteJid":"553192919794@s.whatsapp.net","fromMe":false,"id":"3F12145E2A465ECB4F2D"},"pushName":"x","status":"DELIVERY_ACK","message":{"messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"3Jc+k46kAyv3mg==","senderTimestamp":"1752544226","recipientKeyHash":"G5L7bqzdM4Ih2A==","recipientTimestamp":"1753148794"},"deviceListMetadataVersion":2},"conversation":"ola tenho interesse"},"contextInfo":{"expiration":0,"ephemeralSettingTimestamp":"0","disappearingMode":{"initiator":"CHANGED_IN_CHAT"}},"messageType":"conversation","messageTimestamp":1753366702,"instanceId":"347f1625-9d6c-4084-8746-574a99238f6f","source":"unknown"},"destination":"https://web1.oferta24h.site/webhook/filipe","date_time":"2025-07-24T11:18:23.153Z","sender":"553192566353@s.whatsapp.net","server_url":"https://evo1.oferta24h.site","apikey":"29807299054D-4F56-8FCF-CFF00FA957AC"},"webhookUrl":"https://web1.oferta24h.site/webhook/filipe","executionMode":"production"}}]},"versionId":"8a219188-d6ee-4307-a133-21519f01b3e5","triggerCount":0,"tags":[]}